window.addEventListener("DOMContentLoaded",()=>{"use strict";function e(){const e=document.querySelector("div#edit-area"),i=document.querySelector("details#instruction-area"),a=document.querySelector("details#environment-area");let o=!1;setMobileDevice(),scroll(0,0),n(),t(),e.addEventListener("input",()=>{t()}),E.addEventListener("click",async()=>{q=!1,await s()}),h.addEventListener("click",async()=>{q=!0,await s()}),p.addEventListener("click",async()=>{w=!0,q&&(await s(),q=!1)}),e.addEventListener("focusin",e=>{const t=e.target.matches('input:is([type="text"], [type="number"]), textarea');t&&(o=!0)}),e.addEventListener("focusout",()=>{o=!1}),window.addEventListener("keyup",e=>{if(o)return;const t=new Event("click");switch(e.key){case"i":i.open=!i.open;break;case"e":a.open=!a.open;break;case"/":const n=document.querySelector(":is(input, textarea, button, select):not(:disabled)");n.matches("details#instruction-area *")&&(i.open=!0),n.matches("details#environment-area *")&&(a.open=!0),n.focus();break;case"r":E.disabled||E.dispatchEvent(t);break;case"s":h.disabled||h.dispatchEvent(t);break;case"k":p.disabled||p.dispatchEvent(t)}}),window.addEventListener("beforeunload",e=>{if(M<y.length)return e.preventDefault(),e.returnValue="",""})}function t(){i()&&(a(),X=!1,o(),r())}function n(){for(const e of c)e.value=L[e.id];for(const e of u)e.value=A[e.id]}function i(){let e=!0;for(const t of c){const n=t.id,i=t.value,a=t.validity;t.setCustomValidity(""),a.valid?_[n]=i:(e=!1,t.setCustomValidity("invalid"),a.badInput?t.setCustomValidity("invalid: badInput"):a.valueMissing?t.setCustomValidity("invalid: valueMissing"):a.tooLong?t.setCustomValidity("invalid: tooLong"):a.tooShort&&t.setCustomValidity("invalid: tooShort"))}for(const t of c)Object.values(_).filter(e=>e===t.value).length>1&&(e=!1,t.setCustomValidity("invalid: unique")),t.reportValidity();const t=/^([1-9][0-9]*|0)$/;for(const n of u){const i=n.id,a=Number(n.value),o=Number(n.min),r=Number(n.max),s=n.validity;n.setCustomValidity(""),s.valid&&t.test(String(a))&&o<=a&&a<=r?C[i]=a:(e=!1,n.setCustomValidity("invalid"),s.badInput?n.setCustomValidity("invalid: badInput"):s.valueMissing?n.setCustomValidity("invalid: valueMissing"):s.rangeOverflow||a>r?n.setCustomValidity("invalid: rangeOverflow"):s.rangeUnderflow||a<o?n.setCustomValidity("invalid: rangeUnderflow"):s.stepMismatch&&n.setCustomValidity("invalid: stepMismatch")),n.reportValidity()}return e&&(C.PTR_MAX++,C.VAL_MAX++),E.disabled=!e,h.disabled=!e,e}function a(){y=m.value,M=0,S=0,T=[],N=new Array(C.PTR_MAX).fill(0),V=0,P=0,O=f.value,k=0,R="",X=!0,w=!1,x=0}function o(){g.emptyChild();for(let e=0;e<y.length;e++){const t=document.createElement("span");t.dataset.index=String(e),t.className="",t.textContent="\n"===y[e]?" \n":y[e],g.appendChild(t)}v.emptyChild();const e=String(C.VAL_MAX-1).replace("-","").length;for(let t=0;t<C.PTR_MAX;t++){const n=document.createElement("span");n.dataset.index=String(t),n.className="",n.textContent=String(N[t]).padStart(e,"0"),v.appendChild(n);const i=document.createTextNode(" ");v.appendChild(i)}b.textContent=""}function r(){if(!X||q||C.DELAY_MSEC>0){if(S<y.length){const e=g.querySelector(`span[data-index="${S}"]`);e.classList.remove("highlight")}if(M<y.length){const e=g.querySelector(`span[data-index="${M}"]`);e.classList.add("highlight")}S=M;const e=v.querySelector(`span[data-index="${P}"]`);e.classList.remove("highlight");const t=v.querySelector(`span[data-index="${V}"]`);t.classList.add("highlight");const n=String(C.VAL_MAX-1).replace("-","").length;t.textContent=String(N[V]).padStart(n,"0"),P=V}else{const e=g.querySelectorAll("span[data-index]");for(const t of e)t.classList.remove("highlight");const t=String(C.VAL_MAX-1).replace("-","").length;for(let e=0;e<C.PTR_MAX;e++){const n=v.querySelector(`span[data-index="${e}"]`);n.classList.remove("highlight"),e===V&&n.classList.add("highlight"),n.textContent=String(N[e]).padStart(t,"0")}}b.textContent=R}async function s(){X||(a(),o(),r(),console.log("This code was begun."),consoleTime.begin("run time"));for(const e of c)e.disabled=!0;for(const e of u)e.disabled=!0;for(m.disabled=!0,f.disabled=!0,q||(E.disabled=!0,h.disabled=!0);!w&&M<y.length;){if(x>=C.STEP_MAX){errorAlert(`Cannot run more than ${C.STEP_MAX} steps.`),errorLog(`Cannot run more than ${C.STEP_MAX} steps.`),w=!0;break}if(d(),M++,w)break;if((q||C.DELAY_MSEC>0)&&r(),await l(C.DELAY_MSEC),q&&M<y.length)return}r(),X=!1;for(const e of c)e.disabled=!1;for(const e of u)e.disabled=!1;m.disabled=!1,f.disabled=!1,E.disabled=!1,h.disabled=!1,console.log(`run step: ${x}`),consoleTime.end("run time"),console.log(`This code was ${w?"terminated":"finished"}.`)}function d(){switch(x++,y[M]){case _.PTR_INCREMENT:V++,V+=C.PTR_MAX,V%=C.PTR_MAX;break;case _.PTR_DECREMENT:V--,V+=C.PTR_MAX,V%=C.PTR_MAX;break;case _.VAL_INCREMENT:N[V]++,N[V]+=C.VAL_MAX,N[V]%=C.VAL_MAX;break;case _.VAL_DECREMENT:N[V]--,N[V]+=C.VAL_MAX,N[V]%=C.VAL_MAX;break;case _.VAL_INPUT:k>=O.length?N[V]=0:(N[V]=O.charCodeAt(k)%C.VAL_MAX,k++);break;case _.VAL_OUTPUT:R+=String.fromCharCode(N[V]);break;case _.LOOP_BEGIN:if(T.push(M),0===N[V]){let e=0;for(;M<y.length&&(y[M]===_.LOOP_BEGIN&&e++,y[M]===_.LOOP_END&&e--,0!==e);)M++;if(e>0)return errorAlert(`Cannot find "${_.LOOP_END}".`),errorLog(`Cannot find "${_.LOOP_END}".`),void(w=!0);T.pop()}break;case _.LOOP_END:if(0===T.length)return errorAlert(`Cannot find "${_.LOOP_BEGIN}".`),errorLog(`Cannot find "${_.LOOP_BEGIN}".`),void(w=!0);M=T.pop()-1;break;case _.BREAK_POINT:r(),q=!0,E.disabled=!1,h.disabled=!1;break;case _.COMMENT_LINE:for(;"\n"!==y[M]&&(M++,M<y.length););break;default:x--}}function l(e){return new Promise(t=>{!q&&e>0?setTimeout(()=>{t()},e):t()})}const c=document.querySelectorAll("details#instruction-area input"),u=document.querySelectorAll("details#environment-area input"),m=document.querySelector("textarea#source"),f=document.querySelector("textarea#input"),E=document.querySelector("button#run"),h=document.querySelector("button#step-run"),p=document.querySelector("button#kill"),g=document.querySelector("div#program"),v=document.querySelector("div#memory"),b=document.querySelector("div#output"),L=Object.freeze({PTR_INCREMENT:">",PTR_DECREMENT:"<",VAL_INCREMENT:"+",VAL_DECREMENT:"-",VAL_INPUT:",",VAL_OUTPUT:".",LOOP_BEGIN:"[",LOOP_END:"]",BREAK_POINT:"@",COMMENT_LINE:"#"}),A=Object.freeze({PTR_MAX:255,VAL_MAX:255,STEP_MAX:2e4,DELAY_MSEC:1});let _=structuredClone(L),C=structuredClone(A),y="",M=0,S=0,T=[],N=[],V=0,P=0,O="",k=0,R="",X=!1,q=!1,w=!1,x=0;e()});