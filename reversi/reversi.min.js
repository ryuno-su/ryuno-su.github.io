window.addEventListener("DOMContentLoaded",async()=>{"use strict";function e(){const e=document.querySelector("details#parameter-area"),a=document.querySelector("div#board-area"),c=document.querySelector("details#log-area");let s=!1;document.documentElement.scrollIntoView(),n(),e.addEventListener("input",e=>{e.target.focus(),o()&&(n(),Oe||(Oe=!0,J.classList.replace("shown","hidden"),z.disabled=!0,P.disabled=!0))}),k.addEventListener("click",async e=>{e.target.focus(),await d()}),K.addEventListener("click",e=>{e.target.focus(),r(),n(),Oe=!1,J.classList.replace("hidden","shown"),z.disabled=!1,P.disabled=!1}),V.addEventListener("click",e=>{e.target.focus(),a.scrollIntoView()}),z.addEventListener("click",async e=>{e.target.focus(),Oe||Ae||await d(),T(Se,!He)}),P.addEventListener("click",async e=>{e.target.focus(),Oe||Ae||await d(),E(!he)}),F.addEventListener("click",e=>{e.target.focus();const n=Ae&&!Le;if((!n||window.confirm("Realy reset?"))&&(document.documentElement.scrollIntoView(),Oe?(J.classList.replace("shown","hidden"),z.disabled=!0,P.disabled=!0):(J.classList.replace("hidden","shown"),z.disabled=!1,P.disabled=!1),t(),n)){const e="This game was reset.";Q.textContent=e;const t=e;ee.textContent+=`${t}\n`,ee.scroll(0,ee.scrollHeight)}}),e.addEventListener("focusin",e=>{const t=e.target.matches('input:is([type="text"], [type="number"]), textarea');t&&(s=!0)}),e.addEventListener("focusout",()=>{s=!1}),window.addEventListener("keyup",t=>{if(s)return;const n=new Event("click");switch(t.key){case"/":const r=document.querySelector(":is(input, textarea, button, select):not(:disabled)"),o=r.parentNode;o.matches("details")&&(o.open=!0),r.focus();break;case"p":e.querySelector("summary").focus(),e.open^=!0;break;case"e":k.disabled||k.dispatchEvent(n);break;case"d":K.disabled||K.dispatchEvent(n);break;case"s":V.dispatchEvent(n);break;case"a":z.disabled||z.dispatchEvent(n);break;case"h":P.disabled||P.dispatchEvent(n);break;case"Escape":He&&(z.focus(),T(Se,!1)),he&&(P.focus(),E(!1));break;case"r":F.disabled||F.dispatchEvent(n);break;case"l":c.querySelector("summary").focus(),c.open^=!0}}),window.addEventListener("beforeunload",e=>{const t=Ae&&!Le;t&&e.preventDefault()})}function t(){window.clearInterval(Ce),Q.classList.replace("hidden","shown"),X.classList.replace("shown","hidden"),Z.classList.replace("shown","hidden"),n(),G.forEach((e,t)=>{if("AI_LIST"===t){e.forEach(e=>{e.disabled=!1});const t=document.querySelector("ul#AI_LIST");t.classList.remove("disabled")}else e.matches("option")&&(e=e.parentNode),e.disabled=!1}),k.disabled=!1,K.disabled=!1}function n(){a(),ne.HAND_MODE||c(),s(),i(),l(),Object.freeze(de),Object.freeze(Ee),Object.freeze(ue)}function r(){G.forEach((e,t)=>{if("AI_LIST"===t){e.forEach(e=>{e.checked=!1}),te[t].forEach(t=>{e[t-1].checked=!0});const n=G.AI_LEVEL.parentNode;0===te[t].length?n.classList.replace("shown","hidden"):n.classList.replace("hidden","shown")}else{if(e.matches("select")){const n=[...e.options].findIndex(e=>Number(e.value)===te[t]);e=e.options[n],e.selected=!0,e.textContent=String(te[t]),"DELAY_MSEC"===t&&(e.textContent+="ms")}e.matches('input[type="checkbox"]')&&(e.checked=te[t]),e.value=String(te[t])}}),ne=window.structuredClone(te)}function o(){let e=!0;return G.forEach((t,n)=>{const r=t.value,o=Number(t.value),a=t.validity;if("AI_LIST"===n){ne[n]=[],t.forEach((e,t)=>{const r=e.parentNode;t>=ne.COLOR_NUM?(r.classList.replace("shown","hidden"),e.checked=!1):r.classList.replace("hidden","shown"),e.checked&&ne[n].push(t+1)});const e=G.AI_LEVEL.parentNode;0===ne[n].length?e.classList.replace("shown","hidden"):e.classList.replace("hidden","shown")}else if(t.matches("select"))ne[n]=o;else if(t.matches('input[type="checkbox"]'))ne[n]=t.checked;else{let c=Number(t.min),s=Number(t.max),i=new RegExp(t.pattern),l=t.title;c=2*Math.trunc(Math.log2(ne.COLOR_NUM-1))+4,l=`${c}以上${s}以下の整数を入力してください`,t.setCustomValidity(""),t.min=String(c),t.max=String(s),t.title=l,a.valid&&i.test(r)&&c<=o&&o<=s?ne[n]=o:(e=!1,t.setCustomValidity("invalid"),a.badInput?t.setCustomValidity("invalid: badInput"):a.valueMissing?t.setCustomValidity("invalid: valueMissing"):a.rangeOverflow||o>s?t.setCustomValidity("invalid: rangeOverflow"):a.rangeUnderflow||o<c?t.setCustomValidity("invalid: rangeUnderflow"):a.stepMismatch&&t.setCustomValidity("invalid: stepMismatch")),t.reportValidity()}}),k.disabled=!e,e}function a(){Q.emptyChild(),Z.emptyChild(),le=x.createArray2D(ne.BOARD_HEIGHT+2,ne.BOARD_WIDTH+2,oe.NONE),de=window.structuredClone(le),Te=window.structuredClone(le),Ee=window.structuredClone(le),ue=window.structuredClone(le),Ne=!1,ae=ne.COLOR_NUM,ne.AI_LIST.length===ne.COLOR_NUM&&(Ne=!0,ae++),Se=oe.BLACK;const e=J.querySelector("span.color-text"),t=Y[Se].cloneNode(!0);e.replaceWith(t),Ae=!1,He=!1,he=!1,Le=!1,fe=!1,pe=!1,Re="",Ce=0,me=[2,4].includes(ne.COLOR_NUM)?2:4,Ie=(()=>{const e=Math.trunc(ne.BOARD_WIDTH/2),t=Math.trunc(ne.BOARD_HEIGHT/2),n=Number(G.BOARD_WIDTH.min)-2,r=Number(G.BOARD_HEIGHT.min)-2;return Object.freeze({WEST:e-Math.trunc(n/2)+1,EAST:e-Math.trunc(n/2)+n,NORTH:t-Math.trunc(r/2)+1,SOUTH:t-Math.trunc(r/2)+r})})();const n=2,r=ne.BOARD_WIDTH*ne.BOARD_HEIGHT,o=ne.COLOR_NUM*me,a=ne.HAND_MODE?0:o,c=r-o,s=Math.max(ne.COLOR_NUM-n,1),i=.5,l=i*ce;ce=Math.trunc(c/n)*s,se=r-a+l,ie=0}function c(){const e=Object.freeze({WEST:Math.trunc(ne.BOARD_WIDTH/2),EAST:Math.trunc(ne.BOARD_WIDTH/2)+1,NORTH:Math.trunc(ne.BOARD_HEIGHT/2),SOUTH:Math.trunc(ne.BOARD_HEIGHT/2)+1});switch(ne.COLOR_NUM){case 2:le[e.NORTH][e.WEST]=oe.WHITE,le[e.NORTH][e.EAST]=oe.BLACK,le[e.SOUTH][e.WEST]=oe.BLACK,le[e.SOUTH][e.EAST]=oe.WHITE;break;case 3:le[e.NORTH-1][e.WEST]=oe.BLACK,le[e.NORTH][e.WEST-1]=oe.RED,le[e.NORTH][e.WEST]=oe.WHITE,le[e.NORTH-1][e.EAST]=oe.RED,le[e.NORTH][e.EAST]=oe.BLACK,le[e.NORTH][e.EAST+1]=oe.WHITE,le[e.SOUTH][e.WEST-1]=oe.WHITE,le[e.SOUTH][e.WEST]=oe.BLACK,le[e.SOUTH+1][e.WEST]=oe.RED,le[e.SOUTH][e.EAST]=oe.RED,le[e.SOUTH][e.EAST+1]=oe.BLACK,le[e.SOUTH+1][e.EAST]=oe.WHITE;break;case 4:le[e.NORTH-1][e.WEST]=oe.BLUE,le[e.NORTH][e.WEST]=oe.WHITE,le[e.NORTH][e.EAST]=oe.BLACK,le[e.NORTH][e.EAST+1]=oe.RED,le[e.SOUTH][e.WEST-1]=oe.BLACK,le[e.SOUTH][e.WEST]=oe.RED,le[e.SOUTH][e.EAST]=oe.BLUE,le[e.SOUTH+1][e.EAST]=oe.WHITE;break;case 5:le[e.NORTH-2][e.WEST]=oe.BLUE,le[e.NORTH-1][e.WEST-1]=oe.BLACK,le[e.NORTH-1][e.WEST]=oe.CYAN,le[e.NORTH][e.WEST-1]=oe.BLUE,le[e.NORTH][e.WEST]=oe.WHITE,le[e.NORTH-1][e.EAST]=oe.WHITE,le[e.NORTH-1][e.EAST+1]=oe.BLUE,le[e.NORTH][e.EAST]=oe.BLACK,le[e.NORTH][e.EAST+1]=oe.RED,le[e.NORTH][e.EAST+2]=oe.WHITE,le[e.SOUTH][e.WEST-2]=oe.RED,le[e.SOUTH][e.WEST-1]=oe.BLACK,le[e.SOUTH][e.WEST]=oe.RED,le[e.SOUTH+1][e.WEST-1]=oe.CYAN,le[e.SOUTH+1][e.WEST]=oe.BLACK,le[e.SOUTH][e.EAST]=oe.BLUE,le[e.SOUTH][e.EAST+1]=oe.CYAN,le[e.SOUTH+1][e.EAST]=oe.WHITE,le[e.SOUTH+1][e.EAST+1]=oe.RED,le[e.SOUTH+2][e.EAST]=oe.CYAN;break;case 6:le[e.NORTH-2][e.WEST]=oe.RED,le[e.NORTH-1][e.WEST-1]=oe.CYAN,le[e.NORTH-1][e.WEST]=oe.BLUE,le[e.NORTH][e.WEST-2]=oe.WHITE,le[e.NORTH][e.WEST-1]=oe.MAGENTA,le[e.NORTH][e.WEST]=oe.WHITE,le[e.NORTH-2][e.EAST]=oe.BLACK,le[e.NORTH-1][e.EAST]=oe.CYAN,le[e.NORTH-1][e.EAST+1]=oe.MAGENTA,le[e.NORTH][e.EAST]=oe.BLACK,le[e.NORTH][e.EAST+1]=oe.RED,le[e.NORTH][e.EAST+2]=oe.BLUE,le[e.SOUTH][e.WEST-2]=oe.BLUE,le[e.SOUTH][e.WEST-1]=oe.BLACK,le[e.SOUTH][e.WEST]=oe.RED,le[e.SOUTH+1][e.WEST-1]=oe.MAGENTA,le[e.SOUTH+1][e.WEST]=oe.CYAN,le[e.SOUTH+2][e.WEST]=oe.BLACK,le[e.SOUTH][e.EAST]=oe.BLUE,le[e.SOUTH][e.EAST+1]=oe.MAGENTA,le[e.SOUTH][e.EAST+2]=oe.WHITE,le[e.SOUTH+1][e.EAST]=oe.WHITE,le[e.SOUTH+1][e.EAST+1]=oe.CYAN,le[e.SOUTH+2][e.EAST]=oe.RED;break;case 7:le[e.NORTH-2][e.WEST-1]=oe.WHITE,le[e.NORTH-2][e.WEST]=oe.MAGENTA,le[e.NORTH-1][e.WEST-1]=oe.CYAN,le[e.NORTH-1][e.WEST]=oe.BLUE,le[e.NORTH][e.WEST-2]=oe.BLUE,le[e.NORTH][e.WEST-1]=oe.YELLOW,le[e.NORTH][e.WEST]=oe.WHITE,le[e.NORTH-2][e.EAST]=oe.RED,le[e.NORTH-1][e.EAST]=oe.CYAN,le[e.NORTH-1][e.EAST+1]=oe.YELLOW,le[e.NORTH-1][e.EAST+2]=oe.BLACK,le[e.NORTH][e.EAST]=oe.BLACK,le[e.NORTH][e.EAST+1]=oe.RED,le[e.NORTH][e.EAST+2]=oe.CYAN,le[e.SOUTH][e.WEST-2]=oe.RED,le[e.SOUTH][e.WEST-1]=oe.BLACK,le[e.SOUTH][e.WEST]=oe.RED,le[e.SOUTH+1][e.WEST-2]=oe.YELLOW,le[e.SOUTH+1][e.WEST-1]=oe.MAGENTA,le[e.SOUTH+1][e.WEST]=oe.CYAN,le[e.SOUTH+2][e.WEST]=oe.BLACK,le[e.SOUTH][e.EAST]=oe.BLUE,le[e.SOUTH][e.EAST+1]=oe.MAGENTA,le[e.SOUTH][e.EAST+2]=oe.WHITE,le[e.SOUTH+1][e.EAST]=oe.WHITE,le[e.SOUTH+1][e.EAST+1]=oe.YELLOW,le[e.SOUTH+2][e.EAST]=oe.BLUE;break;case 8:le[e.NORTH-2][e.WEST-1]=oe.YELLOW,le[e.NORTH-2][e.WEST]=oe.ORANGE,le[e.NORTH-1][e.WEST-2]=oe.RED,le[e.NORTH-1][e.WEST-1]=oe.MAGENTA,le[e.NORTH-1][e.WEST]=oe.BLUE,le[e.NORTH][e.WEST-2]=oe.BLUE,le[e.NORTH][e.WEST-1]=oe.ORANGE,le[e.NORTH][e.WEST]=oe.WHITE,le[e.NORTH-2][e.EAST]=oe.RED,le[e.NORTH-2][e.EAST+1]=oe.WHITE,le[e.NORTH-1][e.EAST]=oe.YELLOW,le[e.NORTH-1][e.EAST+1]=oe.CYAN,le[e.NORTH-1][e.EAST+2]=oe.MAGENTA,le[e.NORTH][e.EAST]=oe.BLACK,le[e.NORTH][e.EAST+1]=oe.RED,le[e.NORTH][e.EAST+2]=oe.YELLOW,le[e.SOUTH][e.WEST-2]=oe.CYAN,le[e.SOUTH][e.WEST-1]=oe.BLACK,le[e.SOUTH][e.WEST]=oe.RED,le[e.SOUTH+1][e.WEST-2]=oe.ORANGE,le[e.SOUTH+1][e.WEST-1]=oe.YELLOW,le[e.SOUTH+1][e.WEST]=oe.CYAN,le[e.SOUTH+2][e.WEST-1]=oe.BLUE,le[e.SOUTH+2][e.WEST]=oe.BLACK,le[e.SOUTH][e.EAST]=oe.BLUE,le[e.SOUTH][e.EAST+1]=oe.MAGENTA,le[e.SOUTH][e.EAST+2]=oe.WHITE,le[e.SOUTH+1][e.EAST]=oe.WHITE,le[e.SOUTH+1][e.EAST+1]=oe.ORANGE,le[e.SOUTH+1][e.EAST+2]=oe.BLACK,le[e.SOUTH+2][e.EAST]=oe.MAGENTA,le[e.SOUTH+2][e.EAST+1]=oe.CYAN;break;default:x.exit()}}function s(){const e=ne.BOARD_WIDTH,t=ne.BOARD_HEIGHT,n=e>t?e:t,r=e<=t?e:t,o=Math.trunc(n/2),a=Math.trunc(r/2),c=0,s=o+3;for(const n of x.rangeInt(e+2))de[0][n]=c,de[t+1][n]=c;for(const n of x.rangeInt(t+2))de[n][0]=c,de[n][e+1]=c;const i=s;de[1][1]=i,de[1][e]=i,de[t][1]=i,de[t][e]=i;const l=i-1;de[1][3]=l,de[1][e-2]=l,de[3][1]=l,de[3][e]=l,de[t-2][1]=l,de[t-2][e]=l,de[t][3]=l,de[t][e-2]=l;const d=l-1;for(const n of x.rangeIntAll(4,e-3))de[1][n]=d,de[t][n]=d;for(const n of x.rangeIntAll(4,t-3))de[n][1]=d,de[n][e]=d;const T=c+1;de[1][2]=T,de[1][e-1]=T,de[2][1]=T,de[2][e]=T,de[t-1][1]=T,de[t-1][e]=T,de[t][2]=T,de[t][e-1]=T;for(const n of x.rangeIntAll(2,a)){const r=Math.trunc(n/2);let o=n%2==0?r:i-r;o=o===T?T+1:o,de[n][n]=o,de[n][e-n+1]=o,de[t-n+1][n]=o,de[t-n+1][e-n+1]=o;const a=n%2==0?T+1+r:d-r;for(const r of x.rangeIntAll(n+1,e-n))de[n][r]=a,de[t-n+1][r]=a;for(const r of x.rangeIntAll(n+1,t-n))de[r][n]=a,de[r][e-n+1]=a}}function i(){for(const[e,t]of h())Ee[t][e]=1;if(!ne.LUCKY_MODE)return;const e=x.randomIntRange(4,10),t=ne.BOARD_WIDTH*ne.BOARD_HEIGHT,n=x.randomIntRange(1,Math.trunc(t/8));let r=0;for(;r<n;){const t=x.randomIntRange(1,ne.BOARD_WIDTH),n=x.randomIntRange(1,ne.BOARD_HEIGHT);Ee[n][t]>1||(Ee[n][t]=e,r++)}}function l(){const e=document.createElement("thead"),t=document.createElement("tbody");j.emptyChild();for(const n of x.rangeIntAll(0,ne.BOARD_HEIGHT)){const r=document.createElement("tr");for(const e of x.rangeIntAll(0,ne.BOARD_WIDTH)){const t=document.createElement("th");if(0===n){t.textContent=0===e?" ":x.intToAlp(e-1).toUpperCase(),r.appendChild(t);continue}if(0===e){t.textContent=String(n),r.appendChild(t);continue}const o=document.createElement("td"),a=v[le[n][e]].cloneNode(!0);a.dataset.index=String(u(e,n)),a.querySelector("text").textContent=String(de[n][e]),Ee[n][e]>1&&a.classList.add("lucky"),ne.HAND_MODE&&!H(e,n,Ie)&&a.classList.add("not-init_area"),a.addEventListener("click",async()=>{if(!Oe||Ae)fe||pe||Le||(Oe||Ae?Q.emptyChild():await d(),await S(e,n));else{const e="Please push ENTER or DEFAULT.";Q.textContent=e}}),o.appendChild(a),r.appendChild(o),ue[n][e]=a}0!==n?(t.appendChild(r),j.appendChild(t)):(e.appendChild(r),j.appendChild(e))}}async function d(){Ae=!0,J.classList.replace("hidden","shown"),z.disabled=!1,P.disabled=!1,G.forEach((e,t)=>{if("AI_LIST"===t){e.forEach(e=>{e.disabled=!0});const t=document.querySelector("ul#AI_LIST");t.classList.add("disabled")}else e.matches("option")&&(e=e.parentNode),e.disabled=!0}),k.disabled=!0,K.disabled=!0;const e="This game was started.";Q.textContent=e;const t=x.dedent(`\n        ${e}\n        COLOR_NUM   : ${ne.COLOR_NUM}\n        BOARD_WIDTH : ${ne.BOARD_WIDTH}\n        BOARD_HEIGHT: ${ne.BOARD_HEIGHT}\n        AI_LIST     : ${0===ne.AI_LIST.length?re[0]:ne.AI_LIST.map(e=>re[e])}\n        AI_LEVEL    : ${0===ne.AI_LIST.length?re[0]:ne.AI_LEVEL}\n        DELAY_MSEC  : ${ne.DELAY_MSEC}\n        LUCKY_MODE  : ${ne.LUCKY_MODE}\n        LUCKY_WEIGHT: ${Math.max(...Ee.flat())}\n        HAND_MODE   : ${ne.HAND_MODE}\n    `);ee.textContent+=`${t}\n`,ee.scroll(0,ee.scrollHeight),await W()}function T(e=Se,t=!0){const n=$[e],r=n.getAttribute("class"),o=q[e],a=o.getAttribute("class");for(const[e,n]of h()){const c=ue[n][e],s=(c.getAttribute("class"),v[le[n][e]]),i=s.getAttribute("class");if(t){if(!O(e,n))continue;if(c.classList.contains(a))continue;c.classList.replace(i,a),c.classList.replace(r,a),c.dataset.color=o.dataset.color,c.innerHTML=o.innerHTML}else{if(!c.classList.contains(a))continue;c.classList.replace(a,i),c.dataset.color=s.dataset.color,c.innerHTML=s.innerHTML}const l=c.querySelector("text");l.textContent=String(de[n][e]),he&&l.classList.replace("hidden","shown")}return He=t}function E(e=!0){const t=j.querySelectorAll("svg > text");return t.forEach(t=>{e?t.classList.replace("hidden","shown"):t.classList.replace("shown","hidden")}),he=e}function u(e,t,n=ne.BOARD_WIDTH){const r=n+2,o=t*r+e;return o}async function S(e,t){if(!O(e,t,Se,!0)){const e=!Oe&&Q.hasChildNodes()?" ":"";return Q.appendChild(document.createTextNode(`${e}Cannot put `)),Q.appendChild(Y[Se].cloneNode(!0)),void Q.appendChild(document.createTextNode(" here."))}await N(),await W()}function O(e,t,n=Se,r=!1,o=!0){const a=o?le:Te,c=ue[t][e];let s=0;if(!H(e,t))return 0;if(a[t][e]!==oe.NONE)return 0;if(ne.HAND_MODE){if(H(e,t,Ie)){if(r)if(o){f(),p(e,t,n);const r=String(ie+1),o=r.padStart(String(se).length," "),a=re[n],s=a.padStart(re.filter((e,t)=>t<=ne.COLOR_NUM).map(e=>e.length).max()," "),i=String(e),l=i.padStart(String(ne.BOARD_WIDTH).length," "),d=String(t),T=d.padStart(String(ne.BOARD_HEIGHT).length," "),E=`${x.intToAlp(e-1).toUpperCase()}${t}`,u=E.padStart(String(ne.BOARD_HEIGHT).length+1," "),S=`step: ${o}, turn: ${s}, x: ${l}, y: ${T}, xy: ${u}`;ee.textContent+=`${S}\n`,ee.scroll(0,ee.scrollHeight),Re+=E,L(e,t,n,!0),c.querySelector("rect.highlight-stone").classList.add("highlight-put")}else a[t][e]=n;return 1}return 0}let i=!0;for(const[l,d]of x.range2IntAll(-1,1,-1,1)){if(0===d&&0===l)continue;let[T,E]=[e+d,t+l],u=0;for(;a[E][T]!==n&&a[E][T]!==oe.NONE;)T+=d,E+=l,u++;if(0!==u&&a[E][T]!==oe.NONE&&(s+=u,r)){if(i)if(o){i=!1,f(),p(e,t,n);const r=String(ie+1),o=r.padStart(String(se).length," "),a=re[n],s=a.padStart(re.filter((e,t)=>t<=ne.COLOR_NUM).map(e=>e.length).max()," "),l=String(e),d=l.padStart(String(ne.BOARD_WIDTH).length," "),T=String(t),E=T.padStart(String(ne.BOARD_HEIGHT).length," "),u=`${x.intToAlp(e-1).toUpperCase()}${t}`,S=u.padStart(String(ne.BOARD_HEIGHT).length+1," "),O=`step: ${o}, turn: ${s}, x: ${d}, y: ${E}, xy: ${S}`;ee.textContent+=`${O}\n`,ee.scroll(0,ee.scrollHeight),Re+=u,L(e,t,n,!0),c.querySelector("rect.highlight-stone").classList.add("highlight-put")}else Te[t][e]=n;for([T,E]=[e+d,t+l];u>0;)o?(p(T,E,n),L(T,E,n,!0)):Te[E][T]=n,T+=d,E+=l,u--}}return s}function A(e=Se){for(const[t,n]of h())if(O(t,n,e))return!0;return!1}function H(e,t,n={}){const{WEST:r=1,EAST:o=ne.BOARD_WIDTH,NORTH:a=1,SOUTH:c=ne.BOARD_HEIGHT}=n,s=x.isBetween(e,r,o),i=x.isBetween(t,a,c);return s&&i}function h(e={}){const{WEST:t=1,EAST:n=ne.BOARD_WIDTH,NORTH:r=1,SOUTH:o=ne.BOARD_HEIGHT}=e;return[...x.range2IntAll(r,o,t,n)].map(([e,t])=>[t,e])}function L(e,t,n=Se,r=!0){if(!H(e,t))return!1;const o=ue[t][e],a=(o.getAttribute("class"),v[le[t][e]]),c=a.getAttribute("class"),s=$[n],i=s.getAttribute("class"),l=q[n],d=l.getAttribute("class");if(r){if(o.classList.contains(i))return!1;o.classList.replace(c,i),o.classList.replace(d,i),o.dataset.color=s.dataset.color,o.innerHTML=s.innerHTML}else{if(!o.classList.contains(i))return!1;o.classList.replace(i,c),o.dataset.color=a.dataset.color,o.innerHTML=a.innerHTML}const T=o.querySelector("text");return T.textContent=String(de[t][e]),r}function f(){for(const[e,t]of h())L(e,t,Se,!1)}function p(e,t,n=Se){if(!H(e,t))return;le[t][e]=n;const r=ue[t][e],o=v[n];r.dataset.color=o.dataset.color}async function N(){let e=R(Se);if(e&&fe||ie++,ne.HAND_MODE){const e=ne.COLOR_NUM*me,t=ie<e;if(!t)for(const[e,t]of h()){const n=ue[t][e];H(e,t,Ie)||n.classList.remove("not-init_area")}ne.HAND_MODE=t}if(Le=m(),Le)return;He&&T(Se,!1),he&&E(!1),Se=C(Se);const t=J.querySelector("span.color-text"),n=Y[Se].cloneNode(!0);if(t.replaceWith(n),e=R(Se),fe=!!e||!A(Se),fe){if(!e){Q.emptyChild(),Q.appendChild(document.createTextNode("Cannot put ")),Q.appendChild(Y[Se].cloneNode(!0)),Q.appendChild(document.createTextNode(" any position. ")),Q.appendChild(Y[Se].cloneNode(!0)),Q.appendChild(document.createTextNode(" is passed."));const e=String(ie+1).padStart(String(se).length," "),t=re[Se].padStart(re.filter((e,t)=>t<=ne.COLOR_NUM).map(e=>e.length).max()," "),n=`step: ${e}, turn: ${t}, pass`;ee.textContent+=`${n}\n`,ee.scroll(0,ee.scrollHeight),z.disabled=!0,P.disabled=!0,await D(ne.DELAY_MSEC),z.disabled=!1,P.disabled=!1}await N(),await W()}}function R(e=Se){return Ne&&!ne.AI_LIST.includes(e)}function C(e=Se,t=ae){return(e+t)%t+1}function m(){for(const e of x.rangeIntAll(oe.BLACK,ne.COLOR_NUM))if(A(e))return!1;const e=Object.freeze(x.rangeInt(ne.COLOR_NUM+1).map(e=>I(e)));let t="";Z.emptyChild();const n=e.every(t=>t===e[ne.COLOR_NUM]),r=e.indexOf(Math.max(...e));for(const n of x.rangeIntAll(oe.BLACK,ne.COLOR_NUM))t+=`${re[n]}=${e[n]}, `,Z.appendChild(Y[n].cloneNode(!0)),Z.appendChild(document.createTextNode(`=${e[n]}, `));n?(t+="draw.",Z.appendChild(document.createTextNode("draw."))):(t+=`${re[r]} won.`,Z.appendChild(Y[r].cloneNode(!0)),Z.appendChild(document.createTextNode(" won."))),J.classList.replace("shown","hidden"),Q.classList.replace("hidden","shown"),Z.classList.replace("hidden","shown"),He&&T(Se,!1),he&&E(!1),z.disabled=!0,P.disabled=!0;const o="This game was over.";Q.textContent=o;const a=x.dedent(`\n        result: ${t}\n        record: ${Re}\n        ${o}\n    `);return ee.textContent+=`${a}\n`,ee.scroll(0,ee.scrollHeight),!0}function I(e=Se){let t=0;for(const[n,r]of h())le[r][n]===e&&(t+=Ee[r][n]);return t}function D(e=ne.DELAY_MSEC){if(e<=0)return;if(!pe){const t=2;e*=t}const t=X.querySelector("progress#progress"),n=X.querySelector('label[for="progress"]'),r=X.querySelector('output[for="progress"]'),o=Number(t.max);let a=0,c=Math.trunc(100*a/o);n.textContent=pe&&!fe?"AI thinking ...":"Please wait ...",t.value=`${a}`,t.textContent=`${c}%`,r.textContent=`${c}%`,X.classList.replace("hidden","shown");const s=e/o,i=4;let l=Math.max(s,i),d=Math.trunc(l/s);return new Promise(e=>{Ce=window.setInterval(()=>{a+=d,c=Math.trunc(100*a/o),t.value=`${a}`,t.textContent=`${c}%`,r.textContent=`${c}%`,a>=Number(t.max)&&(X.classList.replace("shown","hidden"),window.clearInterval(Ce),e())},l)})}async function W(){for(const e of ne.AI_LIST)await U()}async function U(){if(!ne.AI_LIST.includes(Se))return;if(Le)return;pe=!0,z.disabled=!0,P.disabled=!0,await D(ne.DELAY_MSEC);const[e,t]=_(ne.AI_LEVEL);O(e,t,Se,!0),Q.emptyChild(),pe=!1,z.disabled=!1,P.disabled=!1,await N()}function _(e){switch(e){case 0:return g();case 1:return b();case 2:return M();case 3:return w();case 4:return y();case 5:return B();default:exit()}}function g(){for(const[e,t]of h())if(O(e,t))return[e,t]}function b(){let e=[];for(const[t,n]of h())O(t,n)&&e.push([t,n]);return e.random()}function M(){let e=1,t=[];for(const[n,r]of h()){const o=O(n,r);o&&(e<=o&&(e<o&&(t=[]),e=o,t.push([n,r])))}return t.random()}function w(){let e=de[0][0]-1,t=[];for(const[n,r]of h())O(n,r)&&e<=de[r][n]&&(e<de[r][n]&&(t=[]),e=de[r][n],t.push([n,r]));return t.random()}function y(){let e=de[1][1]+1,t=[];for(const[n,r]of h()){if(Te=window.structuredClone(le),!O(n,r,Se,!0,!1))continue;let o=de[0][0]-1;for(const[e,t]of h())O(e,t,C(Se),!1,!1)&&(o=Math.max(o,de[t][e]));e>=o&&(e>o&&(t=[]),e=o,t.push([n,r]))}let n=de[0][0]-1,r=[];return t.forEach(([e,t])=>{n<=de[t][e]&&(n<de[t][e]&&(r=[]),n=de[t][e],r.push([e,t]))}),r.random()}function B(){const e=4;return ie<Math.trunc(se/e)?w():ie<Math.trunc(2*se/e)?w():ie<Math.trunc(3*se/e)?y():M()}const x=await import("../library/library.min.js"),v=document.querySelectorAll("div#template-area > svg.cell"),$=document.querySelectorAll("div#template-area > svg.highlight"),q=document.querySelectorAll("div#template-area > svg.assist"),Y=document.querySelectorAll("div#template-area > span.color-text"),G=Object.freeze({COLOR_NUM:document.querySelector("select#COLOR_NUM"),BOARD_WIDTH:document.querySelector("input#BOARD_WIDTH"),BOARD_HEIGHT:document.querySelector("input#BOARD_HEIGHT"),AI_LIST:document.querySelectorAll("ul#AI_LIST input"),AI_LEVEL:document.querySelector("select#AI_LEVEL"),DELAY_MSEC:document.querySelector("select#DELAY_MSEC"),LUCKY_MODE:document.querySelector("input#LUCKY_MODE"),HAND_MODE:document.querySelector("input#HAND_MODE")}),k=document.querySelector("button#enter"),K=document.querySelector("button#default"),V=document.querySelector("button#slide"),j=document.querySelector("table#board"),z=document.querySelector("button#assist"),P=document.querySelector("button#hint"),F=document.querySelector("button#reset"),J=document.querySelector("div#turn"),Q=document.querySelector("div#message"),X=document.querySelector("div#wait"),Z=document.querySelector("div#result"),ee=document.querySelector("div#log"),te=Object.freeze({COLOR_NUM:2,BOARD_WIDTH:8,BOARD_HEIGHT:8,AI_LIST:[],AI_LEVEL:3,DELAY_MSEC:500,LUCKY_MODE:!1,HAND_MODE:!1});let ne=window.structuredClone(te);const re=Object.freeze([...Y].map(e=>e.textContent.toUpperCase())),oe=Object.freeze(x.createEnum(...re));let ae=0,ce=0,se=0,ie=0,le=[],de=[],Te=[],Ee=[],ue=[],Se=0,Oe=!1,Ae=!1,He=!1,he=!1,Le=!1,fe=!1,pe=!1,Ne=!1,Re="",Ce=0,me=0,Ie={};e()});