window.addEventListener("DOMContentLoaded",async()=>{"use strict";function e(){const e=document.querySelector("details#parameter-area"),r=document.querySelector("div#board-area"),c=document.querySelector("details#log-area");let a=!1;x.setMobileDevice(),o(),t(),e.addEventListener("input",()=>{n(),He||(He=!0,Le=!0,z.disabled=!0,P.disabled=!0)}),K.addEventListener("click",async()=>{await d()}),G.addEventListener("click",()=>{o(),n(),He&&(He=!1,Le=!1,z.disabled=!1,P.disabled=!1)}),V.addEventListener("click",()=>{r.scrollIntoView()}),z.addEventListener("click",async()=>{He||(He=!0,await d()),T(Se,!Ae)}),P.addEventListener("click",async()=>{He||(He=!0,await d()),u(!Oe)}),F.addEventListener("click",()=>{const e=K.disabled&&!fe;e&&!window.confirm("Realy reset?")||(t(),e&&(Q.textContent="This game was reset.",ee.textContent+="This game was reset.\n",ee.scroll(0,ee.scrollHeight)))}),e.addEventListener("focusin",e=>{const t=e.target.matches('input:is([type="text"], [type="number"]), textarea');t&&(a=!0)}),e.addEventListener("focusout",()=>{a=!1}),window.addEventListener("keyup",t=>{if(a)return;const n=new Event("click");switch(t.key){case"/":const o=document.querySelector(":is(input, textarea, button, select):not(:disabled)"),r=o.parentNode;r.matches("details")&&(r.open=!0),o.focus();break;case"p":e.open=!e.open;break;case"e":K.disabled||K.dispatchEvent(n);break;case"d":G.disabled||G.dispatchEvent(n);break;case"s":V.dispatchEvent(n);break;case"a":z.disabled||z.dispatchEvent(n);break;case"h":P.disabled||P.dispatchEvent(n);break;case"Escape":Ae&&T(Se,!1),Oe&&u(!1);break;case"r":F.disabled||F.dispatchEvent(n);break;case"l":c.open=!c.open}}),window.addEventListener("beforeunload",e=>{const t=K.disabled&&!fe;t&&e.preventDefault()})}function t(){window.clearInterval(Ne),J.classList.replace("hidden","shown"),Q.classList.replace("hidden","shown"),X.classList.replace("shown","hidden"),Z.classList.replace("shown","hidden"),n(),He=!1,Le=!1,document.documentElement.scrollIntoView(),Y.forEach((e,t)=>{if("AI_LIST"===t){e.forEach(e=>{e.disabled=!1});const t=document.querySelector("ul#AI_LIST");t.classList.remove("disabled")}else e.matches("option")&&(e=e.parentNode),e.disabled=!1}),K.disabled=!1,G.disabled=!1}function n(){r()&&(c(),ne.HAND_MODE||a(),s(),i(),l(),Object.freeze(de),Object.freeze(ue),Object.freeze(Ee))}function o(){Y.forEach((e,t)=>{if("AI_LIST"===t)e.forEach(e=>{e.checked=!1}),te.AI_LIST.forEach(t=>{e[t-1].checked=!0});else{if(e.matches("select")){let n=0;switch(t){case"COLOR_NUM":n=0;break;case"AI_LEVEL":n=te[t];break;case"DELAY_MSEC":n=3}e=e.options[n],e.selected=!0,e.textContent=String(te[t]),"DELAY_MSEC"===t&&(e.textContent+="ms")}e.matches('input[type="checkbox"]')&&(e.checked=te[t]),e.value=te[t]}})}function r(){let e=!0;const t=/^([1-9][0-9]*|0)$/;return Y.forEach((n,o)=>{const r=Number(n.value),c=n.validity;if("AI_LIST"===o){ne.AI_LIST=[],n.forEach((e,t)=>{const n=e.parentNode;n.classList.replace("hidden","shown"),t>=ne.COLOR_NUM&&(n.classList.replace("shown","hidden"),e.checked=!1),e.checked&&ne.AI_LIST.push(t+1)});const e=Y.AI_LEVEL.parentNode;e.classList.replace("hidden","shown"),0===ne.AI_LIST.length&&e.classList.replace("shown","hidden")}else if(n.matches("select"))ne[o]=r;else if(n.matches('input[type="checkbox"]'))ne[o]=n.checked;else{let a=Number(n.min),s=Number(n.max),i=n.title;a=2*Math.trunc(Math.log2(ne.COLOR_NUM-1))+4,i=`${a}以上${s}以下の整数を入力してください`,n.setCustomValidity(""),n.min=String(a),n.max=String(s),n.title=i,c.valid&&t.test(String(r))&&a<=r&&r<=s?ne[o]=r:(e=!1,n.setCustomValidity("invalid"),c.badInput?n.setCustomValidity("invalid: badInput"):c.valueMissing?n.setCustomValidity("invalid: valueMissing"):c.rangeOverflow||r>s?n.setCustomValidity("invalid: rangeOverflow"):c.rangeUnderflow||r<a?n.setCustomValidity("invalid: rangeUnderflow"):c.stepMismatch&&n.setCustomValidity("invalid: stepMismatch")),n.reportValidity()}}),K.disabled=!e,e}function c(){Q.emptyChild(),Z.emptyChild(),le=x.createArray2D(ne.BOARD_HEIGHT+2,ne.BOARD_WIDTH+2,re.NONE),de=window.structuredClone(le),Te=window.structuredClone(le),ue=window.structuredClone(le),Ee=window.structuredClone(le),pe=!1,ce=ne.COLOR_NUM,ne.AI_LIST.length===ne.COLOR_NUM&&(pe=!0,ce++),ae=Math.trunc(ne.BOARD_WIDTH+ne.BOARD_HEIGHT)/2,se=ne.BOARD_WIDTH*ne.BOARD_HEIGHT+ae,ie=0,Se=re.BLACK;const e=J.querySelector("span.color-text"),t=k[Se].cloneNode(!0);e.replaceWith(t),Ae=!1,Oe=!1,fe=!1,he=!1,Ce="",Ne=0,Ie=(()=>{const e=Math.trunc(ne.BOARD_WIDTH/2),t=Math.trunc(ne.BOARD_HEIGHT/2),n=Number(Y.BOARD_WIDTH.min)-2,o=Number(Y.BOARD_HEIGHT.min)-2;return Object.freeze({WEST:e-Math.trunc(n/2)+1,EAST:e-Math.trunc(n/2)+n,NORTH:t-Math.trunc(o/2)+1,SOUTH:t-Math.trunc(o/2)+o})})()}function a(){const e=Object.freeze({WEST:Math.trunc(ne.BOARD_WIDTH/2),EAST:Math.trunc(ne.BOARD_WIDTH/2)+1,NORTH:Math.trunc(ne.BOARD_HEIGHT/2),SOUTH:Math.trunc(ne.BOARD_HEIGHT/2)+1});switch(ne.COLOR_NUM){case 2:le[e.NORTH][e.WEST]=re.WHITE,le[e.NORTH][e.EAST]=re.BLACK,le[e.SOUTH][e.WEST]=re.BLACK,le[e.SOUTH][e.EAST]=re.WHITE;break;case 3:le[e.NORTH-1][e.WEST]=re.BLACK,le[e.NORTH][e.WEST-1]=re.RED,le[e.NORTH][e.WEST]=re.WHITE,le[e.NORTH-1][e.EAST]=re.RED,le[e.NORTH][e.EAST]=re.BLACK,le[e.NORTH][e.EAST+1]=re.WHITE,le[e.SOUTH][e.WEST-1]=re.WHITE,le[e.SOUTH][e.WEST]=re.BLACK,le[e.SOUTH+1][e.WEST]=re.RED,le[e.SOUTH][e.EAST]=re.RED,le[e.SOUTH][e.EAST+1]=re.BLACK,le[e.SOUTH+1][e.EAST]=re.WHITE;break;case 4:le[e.NORTH-1][e.WEST]=re.BLACK,le[e.NORTH][e.WEST]=re.WHITE,le[e.NORTH][e.EAST]=re.BLACK,le[e.NORTH][e.EAST+1]=re.BLUE,le[e.SOUTH][e.WEST-1]=re.WHITE,le[e.SOUTH][e.WEST]=re.RED,le[e.SOUTH][e.EAST]=re.BLUE,le[e.SOUTH+1][e.EAST]=re.RED;break;case 5:le[e.NORTH-2][e.WEST]=re.CYAN,le[e.NORTH-1][e.WEST-1]=re.BLUE,le[e.NORTH-1][e.WEST]=re.BLACK,le[e.NORTH][e.WEST-1]=re.RED,le[e.NORTH][e.WEST]=re.WHITE,le[e.NORTH-1][e.EAST]=re.WHITE,le[e.NORTH-1][e.EAST+1]=re.RED,le[e.NORTH][e.EAST]=re.BLACK,le[e.NORTH][e.EAST+1]=re.CYAN,le[e.NORTH][e.EAST+2]=re.BLUE,le[e.SOUTH][e.WEST-2]=re.BLACK,le[e.SOUTH][e.WEST-1]=re.WHITE,le[e.SOUTH][e.WEST]=re.RED,le[e.SOUTH+1][e.WEST-1]=re.CYAN,le[e.SOUTH+1][e.WEST]=re.BLUE,le[e.SOUTH][e.EAST]=re.BLUE,le[e.SOUTH][e.EAST+1]=re.CYAN,le[e.SOUTH+1][e.EAST]=re.RED,le[e.SOUTH+1][e.EAST+1]=re.BLACK,le[e.SOUTH+2][e.EAST]=re.WHITE;break;case 6:le[e.NORTH-2][e.WEST-1]=re.CYAN,le[e.NORTH-2][e.WEST]=re.MAGENTA,le[e.NORTH-1][e.WEST-1]=re.BLUE,le[e.NORTH-1][e.WEST]=re.BLACK,le[e.NORTH][e.WEST-1]=re.RED,le[e.NORTH][e.WEST]=re.WHITE,le[e.NORTH-1][e.EAST]=re.WHITE,le[e.NORTH-1][e.EAST+1]=re.RED,le[e.NORTH-1][e.EAST+2]=re.BLUE,le[e.NORTH][e.EAST]=re.BLACK,le[e.NORTH][e.EAST+1]=re.MAGENTA,le[e.NORTH][e.EAST+2]=re.CYAN,le[e.SOUTH][e.WEST-2]=re.BLACK,le[e.SOUTH][e.WEST-1]=re.WHITE,le[e.SOUTH][e.WEST]=re.RED,le[e.SOUTH+1][e.WEST-2]=re.MAGENTA,le[e.SOUTH+1][e.WEST-1]=re.CYAN,le[e.SOUTH+1][e.WEST]=re.BLUE,le[e.SOUTH][e.EAST]=re.BLUE,le[e.SOUTH][e.EAST+1]=re.CYAN,le[e.SOUTH+1][e.EAST]=re.RED,le[e.SOUTH+1][e.EAST+1]=re.MAGENTA,le[e.SOUTH+2][e.EAST]=re.WHITE,le[e.SOUTH+2][e.EAST+1]=re.BLACK;break;case 7:le[e.NORTH-2][e.WEST]=re.YELLOW,le[e.NORTH-1][e.WEST-2]=re.CYAN,le[e.NORTH-1][e.WEST-1]=re.MAGENTA,le[e.NORTH-1][e.WEST]=re.BLACK,le[e.NORTH][e.WEST-2]=re.BLUE,le[e.NORTH][e.WEST-1]=re.RED,le[e.NORTH][e.WEST]=re.WHITE,le[e.NORTH-2][e.EAST]=re.RED,le[e.NORTH-2][e.EAST+1]=re.BLUE,le[e.NORTH-1][e.EAST]=re.WHITE,le[e.NORTH-1][e.EAST+1]=re.CYAN,le[e.NORTH][e.EAST]=re.BLACK,le[e.NORTH][e.EAST+1]=re.YELLOW,le[e.NORTH][e.EAST+2]=re.MAGENTA,le[e.SOUTH][e.WEST-2]=re.BLACK,le[e.SOUTH][e.WEST-1]=re.WHITE,le[e.SOUTH][e.WEST]=re.RED,le[e.SOUTH+1][e.WEST-1]=re.YELLOW,le[e.SOUTH+1][e.WEST]=re.BLUE,le[e.SOUTH+2][e.WEST-1]=re.MAGENTA,le[e.SOUTH+2][e.WEST]=re.CYAN,le[e.SOUTH][e.EAST]=re.BLUE,le[e.SOUTH][e.EAST+1]=re.CYAN,le[e.SOUTH][e.EAST+1]=re.MAGENTA,le[e.SOUTH][e.EAST+2]=re.CYAN,le[e.SOUTH+1][e.EAST]=re.RED,le[e.SOUTH+1][e.EAST+1]=re.BLACK,le[e.SOUTH+1][e.EAST+2]=re.YELLOW,le[e.SOUTH+2][e.EAST]=re.WHITE;break;default:x.exit()}}function s(){const e=ne.BOARD_WIDTH,t=ne.BOARD_HEIGHT,n=e>t?e:t,o=e<=t?e:t,r=Math.trunc(n/2),c=Math.trunc(o/2),a=0,s=r+3;for(const n of x.rangeInt(e+2))de[0][n]=a,de[t+1][n]=a;for(const n of x.rangeInt(t+2))de[n][0]=a,de[n][e+1]=a;const i=s;de[1][1]=i,de[1][e]=i,de[t][1]=i,de[t][e]=i;const l=i-1;de[1][3]=l,de[1][e-2]=l,de[3][1]=l,de[3][e]=l,de[t-2][1]=l,de[t-2][e]=l,de[t][3]=l,de[t][e-2]=l;const d=l-1;for(const n of x.rangeIntAll(4,e-3))de[1][n]=d,de[t][n]=d;for(const n of x.rangeIntAll(4,t-3))de[n][1]=d,de[n][e]=d;const T=a+1;de[1][2]=T,de[1][e-1]=T,de[2][1]=T,de[2][e]=T,de[t-1][1]=T,de[t-1][e]=T,de[t][2]=T,de[t][e-1]=T;for(const n of x.rangeIntAll(2,c)){const o=Math.trunc(n/2);let r=n%2==0?o:i-o;r=r===T?T+1:r,de[n][n]=r,de[n][e-n+1]=r,de[t-n+1][n]=r,de[t-n+1][e-n+1]=r;const c=n%2==0?T+1+o:d-o;for(const o of x.rangeIntAll(n+1,e-n))de[n][o]=c,de[t-n+1][o]=c;for(const o of x.rangeIntAll(n+1,t-n))de[o][n]=c,de[o][e-n+1]=c}}function i(){for(const[e,t]of f())ue[t][e]=1;if(!ne.LUCKY_MODE)return;const e=x.randomIntRange(4,10),t=ne.BOARD_WIDTH*ne.BOARD_HEIGHT,n=x.randomIntRange(1,Math.trunc(t/8));let o=0;for(;o<n;){const t=x.randomIntRange(1,ne.BOARD_WIDTH),n=x.randomIntRange(1,ne.BOARD_HEIGHT);ue[n][t]>1||(ue[n][t]=e,o++)}}function l(){const e=document.createElement("thead"),t=document.createElement("tbody");j.emptyChild();for(const n of x.rangeIntAll(0,ne.BOARD_HEIGHT)){const o=document.createElement("tr");for(const e of x.rangeIntAll(0,ne.BOARD_WIDTH)){const t=document.createElement("th");if(0===n){t.textContent=0===e?" ":x.intToAlp(e-1).toUpperCase(),o.appendChild(t);continue}if(0===e){t.textContent=String(n),o.appendChild(t);continue}const r=document.createElement("td"),c=v[le[n][e]].cloneNode(!0);c.dataset.index=String(E(e,n)),c.querySelector("text").textContent=String(de[n][e]),ue[n][e]>1&&c.classList.add("lucky"),ne.HAND_MODE&&!H(e,n,Ie)&&c.classList.add("not-init_area"),c.addEventListener("click",()=>{S(e,n)}),r.appendChild(c),o.appendChild(r),Ee[n][e]=c}0!==n?(t.appendChild(o),j.appendChild(t)):(e.appendChild(o),j.appendChild(e))}}async function d(){Le=!1,z.disabled=!1,P.disabled=!1,Y.forEach((e,t)=>{if("AI_LIST"===t){e.forEach(e=>{e.disabled=!0});const t=document.querySelector("ul#AI_LIST");t.classList.add("disabled")}else e.matches("option")&&(e=e.parentNode),e.disabled=!0}),K.disabled=!0,G.disabled=!0,Q.textContent="This game was started.",ee.textContent+="This game was started.\n",ee.textContent+=`COLOR_NUM: ${ne.COLOR_NUM}\n`,ee.textContent+=`BOARD_WIDTH: ${ne.BOARD_WIDTH}\n`,ee.textContent+=`BOARD_HEIGHT: ${ne.BOARD_HEIGHT}\n`,ee.textContent+=`AI_LIST: ${0===ne.AI_LIST.length?oe[0]:ne.AI_LIST.map(e=>oe[e])}\n`,ee.textContent+=`AI_LEVEL: ${0===ne.AI_LIST.length?oe[0]:ne.AI_LEVEL}\n`,ee.textContent+=`DELAY_MSEC: ${ne.DELAY_MSEC}\n`,ee.textContent+=`LUCKY_MODE: ${ne.LUCKY_MODE}\n`,ee.textContent+=`LUCKY_WEIGHT: ${Math.max(...ue.flat())}\n`,ee.textContent+=`HAND_MODE: ${ne.HAND_MODE}\n`,ee.scroll(0,ee.scrollHeight),await _()}function T(e=Se,t=!0){const n=q[e],o=n.getAttribute("class"),r=$[e],c=r.getAttribute("class");for(const[e,n]of f()){const a=Ee[n][e],s=(a.getAttribute("class"),v[le[n][e]]),i=s.getAttribute("class");if(t){if(!A(e,n))continue;if(a.classList.contains(c))continue;a.classList.replace(i,c),a.classList.replace(o,c),a.dataset.color=r.dataset.color,a.innerHTML=r.innerHTML}else{if(!a.classList.contains(c))continue;a.classList.replace(c,i),a.dataset.color=s.dataset.color,a.innerHTML=s.innerHTML}const l=a.querySelector("text");l.textContent=String(de[n][e]),Oe&&l.classList.replace("hidden","shown")}return Ae=t}function u(e=!0){const t=j.querySelectorAll("svg > text");return t.forEach(t=>{e?t.classList.replace("hidden","shown"):t.classList.replace("shown","hidden")}),Oe=e}function E(e,t,n=ne.BOARD_WIDTH){const o=n+2,r=t*o+e;return r}async function S(e,t){if(!(fe||Le||he)){if(He||(He=!0,await d()),Q.emptyChild(),!A(e,t,Se,!0))return Q.appendChild(document.createTextNode("Cannot put ")),Q.appendChild(k[Se].cloneNode(!0)),void Q.appendChild(document.createTextNode(" here."));await C(),await _()}}function A(e,t,n=Se,o=!1,r=!0){const c=r?le:Te,a=Ee[t][e];let s=0;if(!H(e,t))return 0;if(c[t][e]!==re.NONE)return 0;if(ne.HAND_MODE){if(H(e,t,Ie)){if(o)if(r){L(),p(e,t,n);const o=`${x.intToAlp(e-1).toUpperCase()}${t}`;ee.textContent+=`step: ${ie+1}, turn: ${oe[n]}, x: ${e}, y: ${t}, xy: ${o}\n`,ee.scroll(0,ee.scrollHeight),Ce+=o,h(e,t,n,!0),a.querySelector("rect.highlight-stone").classList.add("highlight-put")}else c[t][e]=n;return 1}return 0}let i=!0;for(const[l,d]of x.range2IntAll(-1,1,-1,1)){if(0===d&&0===l)continue;let[T,u]=[e+d,t+l],E=0;for(;c[u][T]!==n&&c[u][T]!==re.NONE;)T+=d,u+=l,E++;if(0!==E&&c[u][T]!==re.NONE&&(s+=E,o)){if(i)if(r){i=!1,L(),p(e,t,n);const o=`${x.intToAlp(e-1).toUpperCase()}${t}`;ee.textContent+=`step: ${ie+1}, turn: ${oe[n]}, x: ${e}, y: ${t}, xy: ${o}\n`,ee.scroll(0,ee.scrollHeight),Ce+=o,h(e,t,n,!0),a.querySelector("rect.highlight-stone").classList.add("highlight-put")}else Te[t][e]=n;for([T,u]=[e+d,t+l];E>0;)r?(p(T,u,n),h(T,u,n,!0)):Te[u][T]=n,T+=d,u+=l,E--}}return s}function O(e=Se){for(const[t,n]of f())if(A(t,n,e))return!0;return!1}function H(e,t,n={}){const{WEST:o=1,EAST:r=ne.BOARD_WIDTH,NORTH:c=1,SOUTH:a=ne.BOARD_HEIGHT}=n,s=x.isBetween(e,o,r),i=x.isBetween(t,c,a);return s&&i}function f(e={}){const{WEST:t=1,EAST:n=ne.BOARD_WIDTH,NORTH:o=1,SOUTH:r=ne.BOARD_HEIGHT}=e;return[...x.range2IntAll(o,r,t,n)].map(([e,t])=>[t,e])}function h(e,t,n=Se,o=!0){if(!H(e,t))return!1;const r=Ee[t][e],c=(r.getAttribute("class"),v[le[t][e]]),a=c.getAttribute("class"),s=q[n],i=s.getAttribute("class"),l=$[n],d=l.getAttribute("class");if(o){if(r.classList.contains(i))return!1;r.classList.replace(a,i),r.classList.replace(d,i),r.dataset.color=s.dataset.color,r.innerHTML=s.innerHTML}else{if(!r.classList.contains(i))return!1;r.classList.replace(i,a),r.dataset.color=c.dataset.color,r.innerHTML=c.innerHTML}const T=r.querySelector("text");return T.textContent=String(de[t][e]),o}function L(){for(const[e,t]of f())h(e,t,Se,!1)}function p(e,t,n=Se){if(!H(e,t))return;le[t][e]=n;const o=Ee[t][e],r=v[n];o.dataset.color=r.dataset.color}async function C(){let e=N(Se);if(e&&he||ie++,ne.HAND_MODE){const e=2,t=ie<ne.COLOR_NUM*e;if(!t)for(const[e,t]of f()){const n=Ee[t][e];H(e,t,Ie)||n.classList.remove("not-init_area")}ne.HAND_MODE=t}if(fe=R(),fe)return;Ae&&T(Se,!1),Oe&&u(!1),Se=I(Se);const t=J.querySelector("span.color-text"),n=k[Se].cloneNode(!0);t.replaceWith(n),e=N(Se),he=!!e||!O(Se),he&&(e||(Q.emptyChild(),Q.appendChild(document.createTextNode("Cannot put ")),Q.appendChild(k[Se].cloneNode(!0)),Q.appendChild(document.createTextNode(" any position. ")),Q.appendChild(k[Se].cloneNode(!0)),Q.appendChild(document.createTextNode(" is passed.")),ee.textContent+=`step: ${ie+1}, turn: ${oe[Se]}, pass\n`,ee.scroll(0,ee.scrollHeight),z.disabled=!0,P.disabled=!0,await D(ne.DELAY_MSEC),z.disabled=!1,P.disabled=!1),await C(),await _())}function N(e=Se){return pe&&!ne.AI_LIST.includes(e)}function I(e=Se,t=ce){return(e+t)%t+1}function R(){for(const e of x.rangeIntAll(re.BLACK,ne.COLOR_NUM))if(O(e))return!1;const e=Object.freeze(x.rangeInt(ne.COLOR_NUM+1).map(e=>m(e)));let t="";Z.emptyChild();const n=e.every(t=>t==e[ne.COLOR_NUM]),o=e.indexOf(Math.max(...e));for(const n of x.rangeIntAll(re.BLACK,ne.COLOR_NUM))t+=`${oe[n]}=${e[n]}, `,Z.appendChild(k[n].cloneNode(!0)),Z.appendChild(document.createTextNode(`=${e[n]}, `));return n?(t+="draw.",Z.appendChild(document.createTextNode("draw."))):(t+=`${oe[o]} won.`,Z.appendChild(k[o].cloneNode(!0)),Z.appendChild(document.createTextNode(" won."))),Q.textContent="This game was over.",J.classList.replace("shown","hidden"),Q.classList.replace("hidden","shown"),Z.classList.replace("hidden","shown"),Ae&&T(Se,!1),Oe&&u(!1),z.disabled=!0,P.disabled=!0,ee.textContent+=`result: ${t}\n`,ee.textContent+=`record: ${Ce}\n`,ee.textContent+="This game was over.\n",ee.scroll(0,ee.scrollHeight),!0}function m(e=Se){let t=0;for(const[n,o]of f())le[o][n]===e&&(t+=ue[o][n]);return t}function D(e=ne.DELAY_MSEC){if(e<=0)return;if(!Le){const t=2;e*=t}const t=X.querySelector("progress#progress"),n=X.querySelector('label[for="progress"]'),o=X.querySelector('output[for="progress"]'),r=Number(t.max);let c=0,a=Math.trunc(100*c/r);n.textContent=Le&&!he?"AI thinking ...":"Please wait ...",t.value=`${c}`,t.textContent=`${a}%`,o.textContent=`${a}%`,X.classList.replace("hidden","shown");const s=e/r,i=4;let l=Math.max(s,i),d=Math.trunc(l/s);return new Promise(e=>{Ne=window.setInterval(()=>{c+=d,a=Math.trunc(100*c/r),t.value=`${c}`,t.textContent=`${a}%`,o.textContent=`${a}%`,c>=Number(t.max)&&(X.classList.replace("shown","hidden"),window.clearInterval(Ne),e())},l)})}async function _(){for(const e of ne.AI_LIST)await b()}async function b(){if(!ne.AI_LIST.includes(Se))return;if(fe)return;Le=!0,z.disabled=!0,P.disabled=!0,await D(ne.DELAY_MSEC);const[e,t]=W(ne.AI_LEVEL);A(e,t,Se,!0),Q.emptyChild(),Le=!1,z.disabled=!1,P.disabled=!1,await C()}function W(e){switch(e){case 0:return U();case 1:return M();case 2:return y();case 3:return w();case 4:return g();case 5:return B();default:exit()}}function U(){for(const[e,t]of f())if(A(e,t))return[e,t]}function M(){let e=[];for(const[t,n]of f())A(t,n)&&e.push([t,n]);return e.random()}function y(){let e=1,t=[];for(const[n,o]of f()){const r=A(n,o);r&&(e<=r&&(e<r&&(t=[]),e=r,t.push([n,o])))}return t.random()}function w(){let e=de[0][0]-1,t=[];for(const[n,o]of f())A(n,o)&&e<=de[o][n]&&(e<de[o][n]&&(t=[]),e=de[o][n],t.push([n,o]));return t.random()}function g(){let e=de[1][1]+1,t=[];for(const[n,o]of f()){if(Te=window.structuredClone(le),!A(n,o,Se,!0,!1))continue;let r=de[0][0]-1;for(const[e,t]of f())A(e,t,I(Se),!1,!1)&&(r=Math.max(r,de[t][e]));e>=r&&(e>r&&(t=[]),e=r,t.push([n,o]))}let n=de[0][0],o=[];return t.forEach(([e,t])=>{n<=de[t][e]&&(n<de[t][e]&&(o=[]),n=de[t][e],o.push([e,t]))}),o.random()}function B(){const e=4;return ie<Math.trunc(se/e)?w():ie<Math.trunc(2*se/e)?w():ie<Math.trunc(3*se/e)?g():y()}const x=await import("../library/library.min.js"),v=document.querySelectorAll("div#template-area > svg.cell"),q=document.querySelectorAll("div#template-area > svg.highlight"),$=document.querySelectorAll("div#template-area > svg.assist"),k=document.querySelectorAll("div#template-area > span.color-text"),Y=Object.freeze({COLOR_NUM:document.querySelector("select#COLOR_NUM"),BOARD_WIDTH:document.querySelector("input#BOARD_WIDTH"),BOARD_HEIGHT:document.querySelector("input#BOARD_HEIGHT"),AI_LIST:document.querySelectorAll("ul#AI_LIST input"),AI_LEVEL:document.querySelector("select#AI_LEVEL"),DELAY_MSEC:document.querySelector("select#DELAY_MSEC"),LUCKY_MODE:document.querySelector("input#LUCKY_MODE"),HAND_MODE:document.querySelector("input#HAND_MODE")}),K=document.querySelector("button#enter"),G=document.querySelector("button#default"),V=document.querySelector("button#slide"),j=document.querySelector("table#board"),z=document.querySelector("button#assist"),P=document.querySelector("button#hint"),F=document.querySelector("button#reset"),J=document.querySelector("div#turn"),Q=document.querySelector("div#message"),X=document.querySelector("div#wait"),Z=document.querySelector("div#result"),ee=document.querySelector("div#log"),te=Object.freeze({COLOR_NUM:2,BOARD_WIDTH:8,BOARD_HEIGHT:8,AI_LIST:[],AI_LEVEL:3,DELAY_MSEC:500,LUCKY_MODE:!1,HAND_MODE:!1});let ne=window.structuredClone(te);const oe=Object.freeze([...k].map(e=>e.textContent.toUpperCase())),re=Object.freeze(x.createEnum(oe));let ce=0,ae=0,se=0,ie=0,le=[],de=[],Te=[],ue=[],Ee=[],Se=0,Ae=!1,Oe=!1,He=!1,fe=!1,he=!1,Le=!1,pe=!1,Ce="",Ne=0,Ie={};e()});