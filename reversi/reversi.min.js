window.addEventListener("DOMContentLoaded",()=>{"use strict";function e(){const e=document.querySelector("details#parameter-area");let o=!1;setMobileDevice(),scroll(0,0),r(),t(),e.addEventListener("input",()=>{n(),Ee||(Ee=!0,Ae=!0,Y.disabled=!0,K.disabled=!0)}),$.addEventListener("click",async()=>{await l()}),Y.addEventListener("click",async()=>{Ee||(Ee=!0,await l()),d(Te,!le)}),K.addEventListener("click",async()=>{Ee||(Ee=!0,await l()),E(!de)}),V.addEventListener("click",()=>{const e=$.disabled&&!ue;e&&!confirm("Realy reset?")||(t(),e&&(z.textContent="This game was reset.",J.textContent+="This game was over.\n"))}),e.addEventListener("focusin",e=>{const t=e.target.matches('input:is([type="text"], [type="number"]), textarea');t&&(o=!0)}),e.addEventListener("focusout",()=>{o=!1}),window.addEventListener("keyup",t=>{if(o)return;const n=new Event("click");switch(t.key){case"e":$.disabled||$.dispatchEvent(n);break;case"r":V.disabled||V.dispatchEvent(n);break;case"p":e.open=!e.open;break;case"/":const r=document.querySelector(":is(input, textarea, button, select):not(:disabled)"),o=r.parentNode;o.matches("details")&&(o.open=!0),r.focus();break;case"a":Y.disabled||Y.dispatchEvent(n);break;case"h":K.disabled||K.dispatchEvent(n);break;case"Escape":le&&d(Te,!1),de&&E(!1)}}),window.addEventListener("beforeunload",e=>{if($.disabled&&!ue)return e.preventDefault(),e.returnValue="",""})}function t(){clearInterval(Le),j.classList.replace("hidden","shown"),z.classList.replace("hidden","shown"),P.classList.replace("shown","hidden"),F.classList.replace("shown","hidden"),n(),Ee=!1,Ae=!1;for(let[e,t]of Object.entries(G))"AI_LIST"!==e&&(t.matches("option")&&(t=t.parentNode),t.disabled=!1);G.AI_LIST.forEach(e=>{e.disabled=!1});const e=document.querySelector("ul#AI_LIST");e.classList.remove("disabled"),$.disabled=!1}function n(){o()&&(a(),X.HAND_MODE||c(),s(),i(),T(),Object.freeze(ae),Object.freeze(se),Object.freeze(ie))}function r(){for(let[e,t]of Object.entries(G))if("AI_LIST"!==e){if(t.matches("select")){let n=0;"AI_LEVEL"===e&&(n=Q[e]),"DELAY_MSEC"===e&&(n=3),t=t.options[n],t.selected=!0,t.textContent=String(Q[e]),"DELAY_MSEC"===e&&(t.textContent+="ms")}t.matches('input[type="checkbox"]')&&(t.checked=Q[e]),t.value=Q[e]}for(const e of G.AI_LIST)e.checked=!1;for(const e of Q.AI_LIST)G.AI_LIST[e-1].checked=!0}function o(){let e=!0;const t=/^([1-9][0-9]*|0)$/;for(let[n,r]of Object.entries(G)){const o=Number(r.value);let a=Number(r.min),c=Number(r.max),s=r.title;const i=r.validity;if("AI_LIST"!==n)if(r.matches("select"))X[n]=o;else{if(r.matches("input")){if(r.matches('[type="checkbox"]')){X[n]=r.checked;continue}a=2*Math.trunc(Math.log2(X.COLOR_NUM-1))+4,s=`${a}以上${c}以下の整数を入力してください`}r.setCustomValidity(""),i.valid&&t.test(String(o))&&a<=o&&o<=c?X[n]=o:(e=!1,r.setCustomValidity("invalid"),i.badInput?r.setCustomValidity("invalid: badInput"):i.valueMissing?r.setCustomValidity("invalid: valueMissing"):i.rangeOverflow||o>c?r.setCustomValidity("invalid: rangeOverflow"):i.rangeUnderflow||o<a?r.setCustomValidity("invalid: rangeUnderflow"):i.stepMismatch&&r.setCustomValidity("invalid: stepMismatch")),r.reportValidity(),r.min=String(a),r.max=String(c),r.title=s}}X.AI_LIST=[];for(let e=0;e<G.AI_LIST.length;e++){const t=G.AI_LIST[e].parentNode;t.classList.replace("hidden","shown"),e>=X.COLOR_NUM&&(t.classList.replace("shown","hidden"),G.AI_LIST[e].checked=!1),G.AI_LIST[e].checked&&X.AI_LIST.push(e+1)}const n=G.AI_LEVEL.parentNode;return n.classList.replace("hidden","shown"),0===X.AI_LIST.length&&n.classList.replace("shown","hidden"),$.disabled=!e,e}function a(){z.textContent="",F.textContent="",oe=new Array(X.BOARD_HEIGHT+2);for(let e=0;e<X.BOARD_HEIGHT+2;e++)oe[e]=new Array(X.BOARD_WIDTH+2).fill(ee.NONE);ae=structuredClone(oe),ce=structuredClone(oe),se=structuredClone(oe),ie=structuredClone(oe),He=!1,X.AI_LIST.length===X.COLOR_NUM&&(He=!0,X.COLOR_NUM++),te=Math.trunc(X.BOARD_WIDTH+X.BOARD_HEIGHT)/2,ne=X.BOARD_WIDTH*X.BOARD_HEIGHT+te,re=0,Te=ee.BLACK;const e=j.querySelector("span.color-text"),t=q[Te].cloneNode(!0);e.replaceWith(t),le=!1,de=!1,ue=!1,Se=!1,Oe="",fe=(()=>{const e=Math.trunc(X.BOARD_WIDTH/2),t=Math.trunc(X.BOARD_HEIGHT/2),n=Number(G.BOARD_WIDTH.min)-2,r=Number(G.BOARD_HEIGHT.min)-2;return Object.freeze({WEST:e-Math.trunc(n/2)+1,EAST:e-Math.trunc(n/2)+n,NORTH:t-Math.trunc(r/2)+1,SOUTH:t-Math.trunc(r/2)+r})})()}function c(){let e=X.COLOR_NUM;He&&e--;const t=Object.freeze({WEST:Math.trunc(X.BOARD_WIDTH/2),EAST:Math.trunc(X.BOARD_WIDTH/2)+1,NORTH:Math.trunc(X.BOARD_HEIGHT/2),SOUTH:Math.trunc(X.BOARD_HEIGHT/2)+1});switch(e){case 2:oe[t.NORTH][t.WEST]=ee.WHITE,oe[t.NORTH][t.EAST]=ee.BLACK,oe[t.SOUTH][t.WEST]=ee.BLACK,oe[t.SOUTH][t.EAST]=ee.WHITE;break;case 3:oe[t.NORTH-1][t.WEST]=ee.BLACK,oe[t.NORTH][t.WEST-1]=ee.RED,oe[t.NORTH][t.WEST]=ee.WHITE,oe[t.NORTH-1][t.EAST]=ee.RED,oe[t.NORTH][t.EAST]=ee.BLACK,oe[t.NORTH][t.EAST+1]=ee.WHITE,oe[t.SOUTH][t.WEST-1]=ee.WHITE,oe[t.SOUTH][t.WEST]=ee.BLACK,oe[t.SOUTH+1][t.WEST]=ee.RED,oe[t.SOUTH][t.EAST]=ee.RED,oe[t.SOUTH][t.EAST+1]=ee.BLACK,oe[t.SOUTH+1][t.EAST]=ee.WHITE;break;case 4:oe[t.NORTH-1][t.WEST]=ee.BLACK,oe[t.NORTH][t.WEST]=ee.WHITE,oe[t.NORTH][t.EAST]=ee.BLACK,oe[t.NORTH][t.EAST+1]=ee.BLUE,oe[t.SOUTH][t.WEST-1]=ee.WHITE,oe[t.SOUTH][t.WEST]=ee.RED,oe[t.SOUTH][t.EAST]=ee.BLUE,oe[t.SOUTH+1][t.EAST]=ee.RED;break;case 5:oe[t.NORTH-2][t.WEST]=ee.CYAN,oe[t.NORTH-1][t.WEST-1]=ee.BLUE,oe[t.NORTH-1][t.WEST]=ee.BLACK,oe[t.NORTH][t.WEST-1]=ee.RED,oe[t.NORTH][t.WEST]=ee.WHITE,oe[t.NORTH-1][t.EAST]=ee.WHITE,oe[t.NORTH-1][t.EAST+1]=ee.RED,oe[t.NORTH][t.EAST]=ee.BLACK,oe[t.NORTH][t.EAST+1]=ee.CYAN,oe[t.NORTH][t.EAST+2]=ee.BLUE,oe[t.SOUTH][t.WEST-2]=ee.BLACK,oe[t.SOUTH][t.WEST-1]=ee.WHITE,oe[t.SOUTH][t.WEST]=ee.RED,oe[t.SOUTH+1][t.WEST-1]=ee.CYAN,oe[t.SOUTH+1][t.WEST]=ee.BLUE,oe[t.SOUTH][t.EAST]=ee.BLUE,oe[t.SOUTH][t.EAST+1]=ee.CYAN,oe[t.SOUTH+1][t.EAST]=ee.RED,oe[t.SOUTH+1][t.EAST+1]=ee.BLACK,oe[t.SOUTH+2][t.EAST]=ee.WHITE;break;case 6:oe[t.NORTH-2][t.WEST-1]=ee.CYAN,oe[t.NORTH-2][t.WEST]=ee.MAGENTA,oe[t.NORTH-1][t.WEST-1]=ee.BLUE,oe[t.NORTH-1][t.WEST]=ee.BLACK,oe[t.NORTH][t.WEST-1]=ee.RED,oe[t.NORTH][t.WEST]=ee.WHITE,oe[t.NORTH-1][t.EAST]=ee.WHITE,oe[t.NORTH-1][t.EAST+1]=ee.RED,oe[t.NORTH-1][t.EAST+2]=ee.BLUE,oe[t.NORTH][t.EAST]=ee.BLACK,oe[t.NORTH][t.EAST+1]=ee.MAGENTA,oe[t.NORTH][t.EAST+2]=ee.CYAN,oe[t.SOUTH][t.WEST-2]=ee.BLACK,oe[t.SOUTH][t.WEST-1]=ee.WHITE,oe[t.SOUTH][t.WEST]=ee.RED,oe[t.SOUTH+1][t.WEST-2]=ee.MAGENTA,oe[t.SOUTH+1][t.WEST-1]=ee.CYAN,oe[t.SOUTH+1][t.WEST]=ee.BLUE,oe[t.SOUTH][t.EAST]=ee.BLUE,oe[t.SOUTH][t.EAST+1]=ee.CYAN,oe[t.SOUTH+1][t.EAST]=ee.RED,oe[t.SOUTH+1][t.EAST+1]=ee.MAGENTA,oe[t.SOUTH+2][t.EAST]=ee.WHITE,oe[t.SOUTH+2][t.EAST+1]=ee.BLACK;break;case 7:oe[t.NORTH-2][t.WEST]=ee.YELLOW,oe[t.NORTH-1][t.WEST-2]=ee.CYAN,oe[t.NORTH-1][t.WEST-1]=ee.MAGENTA,oe[t.NORTH-1][t.WEST]=ee.BLACK,oe[t.NORTH][t.WEST-2]=ee.BLUE,oe[t.NORTH][t.WEST-1]=ee.RED,oe[t.NORTH][t.WEST]=ee.WHITE,oe[t.NORTH-2][t.EAST]=ee.RED,oe[t.NORTH-2][t.EAST+1]=ee.BLUE,oe[t.NORTH-1][t.EAST]=ee.WHITE,oe[t.NORTH-1][t.EAST+1]=ee.CYAN,oe[t.NORTH][t.EAST]=ee.BLACK,oe[t.NORTH][t.EAST+1]=ee.YELLOW,oe[t.NORTH][t.EAST+2]=ee.MAGENTA,oe[t.SOUTH][t.WEST-2]=ee.BLACK,oe[t.SOUTH][t.WEST-1]=ee.WHITE,oe[t.SOUTH][t.WEST]=ee.RED,oe[t.SOUTH+1][t.WEST-1]=ee.YELLOW,oe[t.SOUTH+1][t.WEST]=ee.BLUE,oe[t.SOUTH+2][t.WEST-1]=ee.MAGENTA,oe[t.SOUTH+2][t.WEST]=ee.CYAN,oe[t.SOUTH][t.EAST]=ee.BLUE,oe[t.SOUTH][t.EAST+1]=ee.CYAN,oe[t.SOUTH][t.EAST+1]=ee.MAGENTA,oe[t.SOUTH+1][t.EAST]=ee.RED,oe[t.SOUTH+1][t.EAST+1]=ee.BLACK,oe[t.SOUTH+1][t.EAST+2]=ee.YELLOW,oe[t.SOUTH+2][t.EAST]=ee.WHITE;break;default:exit()}}function s(){const e=X.BOARD_WIDTH,t=X.BOARD_HEIGHT,n=e>t?e:t,r=e<=t?e:t,o=Math.trunc(n/2),a=Math.trunc(r/2),c=0,s=o+3;for(let n=0;n<=e+1;n++)ae[0][n]=c,ae[t+1][n]=c;for(let n=0;n<=t+1;n++)ae[n][0]=c,ae[n][e+1]=c;const i=s;ae[1][1]=i,ae[1][e]=i,ae[t][1]=i,ae[t][e]=i;const T=i-1;ae[1][3]=T,ae[1][e-2]=T,ae[3][1]=T,ae[3][e]=T,ae[t-2][1]=T,ae[t-2][e]=T,ae[t][3]=T,ae[t][e-2]=T;const l=T-1;for(let n=4;n<=e-3;n++)ae[1][n]=l,ae[t][n]=l;for(let n=4;n<=t-3;n++)ae[n][1]=l,ae[n][e]=l;const d=c+1;ae[1][2]=d,ae[1][e-1]=d,ae[2][1]=d,ae[2][e]=d,ae[t-1][1]=d,ae[t-1][e]=d,ae[t][2]=d,ae[t][e-1]=d;for(let n=2;n<=a;n++){const r=Math.trunc(n/2);let o=n%2==0?r:i-r;o=o===d?d+1:o,ae[n][n]=o,ae[n][e-n+1]=o,ae[t-n+1][n]=o,ae[t-n+1][e-n+1]=o;const a=n%2==0?d+1+r:l-r;for(let r=n+1;r<=e-n;r++)ae[n][r]=a,ae[t-n+1][r]=a;for(let r=n+1;r<=t-n;r++)ae[r][n]=a,ae[r][e-n+1]=a}}function i(){for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)se[e][t]=1;if(!X.LUCKY_MODE)return;const e=randomIntRange(4,10),t=X.BOARD_WIDTH*X.BOARD_HEIGHT,n=randomIntRange(1,Math.trunc(t/8));let r=0;for(;r<n;){const t=randomIntRange(1,X.BOARD_WIDTH),n=randomIntRange(1,X.BOARD_HEIGHT);se[n][t]>1||(se[n][t]=e,r++)}}function T(){k.emptyChild();for(let e=1;e<=X.BOARD_HEIGHT;e++){for(let t=1;t<=X.BOARD_WIDTH;t++){const n=g[oe[e][t]].cloneNode(!0);n.dataset.index=String(u(t,e)),n.querySelector("text").textContent=String(ae[e][t]),se[e][t]>1&&n.classList.add("lucky"),X.HAND_MODE&&!O(t,e,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)&&n.classList.add("not-init_area"),n.addEventListener("click",()=>{S(t,e)}),k.appendChild(n),ie[e][t]=k.querySelector(`svg[data-index="${u(t,e)}"]`)}k.appendChild(document.createElement("br"))}}async function l(){Ae=!1,Y.disabled=!1,K.disabled=!1;for(let[e,t]of Object.entries(G))"AI_LIST"!==e&&(t.matches("option")&&(t=t.parentNode),t.disabled=!0);G.AI_LIST.forEach(e=>{e.disabled=!0});const e=document.querySelector("ul#AI_LIST");e.classList.add("disabled"),$.disabled=!0,z.textContent="This game was started.",J.textContent+="This game was started.\n",J.textContent+=`COLOR_NUM: ${X.COLOR_NUM}\n`,J.textContent+=`BOARD_WIDTH: ${X.BOARD_WIDTH}\n`,J.textContent+=`BOARD_HEIGHT: ${X.BOARD_HEIGHT}\n`,J.textContent+=`AI_LIST: ${0===X.AI_LIST.length?Z[0]:X.AI_LIST.map(e=>Z[e])}\n`,J.textContent+=`AI_LEVEL: ${0===X.AI_LIST.length?Z[0]:X.AI_LEVEL}\n`,J.textContent+=`DELAY_MSEC: ${X.DELAY_MSEC}ms\n`,J.textContent+=`LUCKY_MODE: ${X.LUCKY_MODE}\n`,J.textContent+=`luckyWeight: ${Math.max(...se.flat())}\n`,J.textContent+=`HAND_MODE: ${X.HAND_MODE}\n`,await p()}function d(e=Te,t=!0){const n=v[e].cloneNode(!0),r=n.getAttribute("class");for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let o=1;o<=X.BOARD_WIDTH;o++){const a=ie[e][o];if(t){if(!A(o,e))continue;a.setAttribute("class",r),a.dataset.color=n.dataset.color,a.innerHTML=n.innerHTML}else{const t=g[oe[e][o]].cloneNode(!0),n=a.getAttribute("class"),c=t.getAttribute("class");if(n!==r)continue;a.setAttribute("class",c),a.dataset.color=t.dataset.color,a.innerHTML=t.innerHTML}const c=a.querySelector("text");c.textContent=String(ae[e][o]),de&&c.classList.replace("hidden","shown")}return le=t}function E(e=!0){const t=k.querySelectorAll("svg > text");return t.forEach(t=>{e?t.classList.replace("hidden","shown"):t.classList.replace("shown","hidden")}),de=e}function u(e,t,n=X.BOARD_WIDTH){const r=n+2,o=t*r+e;return o}async function S(e,t){if(!(ue||Ae||Se)){if(Ee||(Ee=!0,await l()),z.textContent="",!A(e,t,Te,!0))return z.appendChild(document.createTextNode("Cannot put ")),z.appendChild(q[Te].cloneNode(!0)),void z.appendChild(document.createTextNode(" here."));await R(),await p()}}function A(e,t,n=Te,r=!1,o=!0){const a=ie[t][e];let c=0;if(!O(e,t))return 0;const s=o?oe[t][e]:ce[t][e];if(s>ee.NONE)return 0;if(X.HAND_MODE){if(O(e,t,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)){if(r)if(o){f(),I(e,t,n);const r=`${String.fromCharCode(e-1+"A".charCodeAt(0))}${t}`;J.textContent+=`turn: ${Z[n]}, x: ${e}, y: ${t}, xy: ${r}\n`,Oe+=r,L(e,t,n,!0),a.querySelector("rect.highlight-stone").classList.add("highlight-put")}else ce[t][e]=n;return 1}return 0}let i=!0;for(let s=-1;s<=1;s++)for(let T=-1;T<=1;T++){if(0===T&&0===s)continue;let l=e+T,d=t+s,E=0,u=o?oe[d][l]:ce[d][l];for(;u!==n&&u!==ee.NONE;)l+=T,d+=s,E++,u=o?oe[d][l]:ce[d][l];if(0!==E&&u!==ee.NONE&&(c+=E,r)){if(i)if(o){i=!1,f(),I(e,t,n);const r=`${String.fromCharCode(e-1+"A".charCodeAt(0))}${t}`;J.textContent+=`turn: ${Z[n]}, x: ${e}, y: ${t}, xy: ${r}\n`,Oe+=r,L(e,t,n,!0),a.querySelector("rect.highlight-stone").classList.add("highlight-put")}else ce[t][e]=n;for(l=e+T,d=t+s;E>0;)o?(I(l,d,n),L(l,d,n,!0)):ce[d][l]=n,l+=T,d+=s,E--}}return c}function H(e=Te){for(let t=1;t<=X.BOARD_HEIGHT;t++)for(let n=1;n<=X.BOARD_WIDTH;n++)if(A(n,t,e))return!0;return!1}function O(e,t,n=1,r=X.BOARD_WIDTH,o=1,a=X.BOARD_HEIGHT){const c=n<=e&&e<=r,s=o<=t&&t<=a;return c&&s}function L(e,t,n=Te,r=!0){if(!O(e,t))return;const o=ie[t][e],a=g[oe[t][e]].cloneNode(!0),c=w[n].cloneNode(!0),s=a.getAttribute("class"),i=c.getAttribute("class");return r?(o.setAttribute("class",i),o.dataset.color=c.dataset.color,o.innerHTML=c.innerHTML):(o.setAttribute("class",s),o.dataset.color=a.dataset.color,o.innerHTML=a.innerHTML),o.querySelector("text").textContent=String(ae[t][e]),se[t][e]>1&&o.classList.add("lucky"),X.HAND_MODE&&!O(e,t,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)&&o.classList.add("not-init_area"),r}function f(){for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)L(t,e,Te,!1)}function I(e,t,n=Te){if(!O(e,t))return;oe[t][e]=n;const r=ie[t][e],o=g[n].cloneNode(!0);r.dataset.color=o.dataset.color,r.innerHTML=o.innerHTML,r.querySelector("text").textContent=String(ae[t][e]),se[t][e]>1&&o.classList.add("lucky"),X.HAND_MODE&&!O(e,t,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)&&o.classList.add("not-init_area")}async function R(){let e=D(Te);if(e&&Se||re++,X.HAND_MODE){let e=X.COLOR_NUM;He&&e--;const t=2,n=re<e*t;if(!n)for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++){const n=ie[e][t];(t<fe.WEST||fe.EAST<t||e<fe.NORTH||fe.SOUTH<e)&&n.classList.remove("not-init_area")}X.HAND_MODE=n}if(ue=_(),ue)return;le&&d(Te,!1),de&&E(!1),Te=N(Te);const t=j.querySelector("span.color-text"),n=q[Te].cloneNode(!0);t.replaceWith(n),e=D(Te),Se=!!e||!H(Te),Se&&(e||(z.appendChild(document.createTextNode("Cannot put ")),z.appendChild(q[Te].cloneNode(!0)),z.appendChild(document.createTextNode(" any position. ")),z.appendChild(q[Te].cloneNode(!0)),z.appendChild(document.createTextNode(" is passed.")),J.textContent+=`turn: ${Z[Te]}, pass\n`,Y.disabled=!0,K.disabled=!0,await C(X.DELAY_MSEC),Y.disabled=!1,K.disabled=!1),await R(),await p())}function D(e=Te){return He&&!X.AI_LIST.includes(e)}function N(e=Te,t=X.COLOR_NUM){return(e+t)%t+1}function h(e=Te){let t=0;for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let r=1;r<=X.BOARD_WIDTH;r++)oe[n][r]===e&&(t+=se[n][r]);return t}function _(){let e=X.COLOR_NUM;for(let t=ee.NONE+1;t<=e;t++)if(H(t))return!1;const t=new Array(e+1).fill(0);for(let n=ee.NONE;n<=e;n++)t[n]=h(n);let n="";F.textContent="";let r=!0,o=0,a=ee.NONE;He&&e--;for(let c=ee.NONE+1;c<=e;c++)n+=`${Z[c]}=${t[c]}, `,F.appendChild(q[c].cloneNode(!0)),F.appendChild(document.createTextNode(`=${t[c]}, `)),t[c]!==t[e]&&(r=!1),o<t[c]&&(o=t[c],a=c);return r?(n+="draw.",F.appendChild(document.createTextNode("draw."))):(n+=`${Z[a]} won.`,F.appendChild(q[a].cloneNode(!0)),F.appendChild(document.createTextNode(" won."))),z.textContent="This game was over.",j.classList.replace("shown","hidden"),z.classList.replace("hidden","shown"),F.classList.replace("hidden","shown"),f(),d(Te,!1),E(!1),Y.disabled=!0,K.disabled=!0,J.textContent+=`result: ${n}\n`,J.textContent+=`record: ${Oe}\n`,J.textContent+="This game was over.\n",!0}function C(e){if(e<=0)return new Promise(e=>{e()});if(!Ae){const t=2;e*=t}const t=P.querySelector("progress#progress"),n=P.querySelector('label[for="progress"]'),r=P.querySelector('output[for="progress"]');let o=0;n.textContent=Ae&&!Se?"AI thinking ...":"Please wait ...",t.value=`${o}`,t.textContent=`${o}%`,r.textContent=`${o}%`,P.classList.replace("hidden","shown");let a=Math.max(e/Number(t.max),4),c=Math.trunc(Number(t.max)/(e/a));return new Promise(e=>{Le=setInterval(()=>{o+=c,t.value=`${o}`,t.textContent=`${o}%`,r.textContent=`${o}%`,o>=Number(t.max)&&(P.classList.replace("shown","hidden"),clearInterval(Le),e())},a)})}async function p(){for(const e of X.AI_LIST)await W()}async function W(){if(!X.AI_LIST.includes(Te))return;if(ue)return;Ae=!0,Y.disabled=!0,K.disabled=!0,await C(X.DELAY_MSEC);const[e,t]=m(X.AI_LEVEL);A(e,t,Te,!0),z.textContent="",Ae=!1,Y.disabled=!1,K.disabled=!1,await R()}function m(e=0){switch(e){case 0:return B();case 1:return U();case 2:return M();case 3:return b();case 4:return y();case 5:return x();default:exit()}}function B(){for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)if(A(t,e))return[t,e]}function U(){let e=[];for(let t=1;t<=X.BOARD_HEIGHT;t++)for(let n=1;n<=X.BOARD_WIDTH;n++)A(n,t)&&e.push([n,t]);return e[randomInt(e.length)]}function M(){let e=1,t=[];for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let r=1;r<=X.BOARD_WIDTH;r++){let o=A(r,n);e<=o&&(e<o&&(t=[]),e=o,t.push([r,n]))}return t[randomInt(t.length)]}function b(){let e=ae[0][0]-1,t=[];for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let r=1;r<=X.BOARD_WIDTH;r++)A(r,n)&&e<=ae[n][r]&&(e<ae[n][r]&&(t=[]),e=ae[n][r],t.push([r,n]));return t[randomInt(t.length)]}function y(){let e=ae[1][1]+1,t=[];for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let r=1;r<=X.BOARD_WIDTH;r++){if(ce=structuredClone(oe),!A(r,n,Te,!0,!1))continue;let o=ae[0][0]-1;for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)A(t,e,N(Te),!1,!1)&&(o=Math.max(o,ae[e][t]));e>=o&&(e>o&&(t=[]),e=o,t.push([r,n]))}let n=ae[0][0],r=[];for(const[e,o]of t)n<=ae[o][e]&&(n<ae[o][e]&&(r=[]),n=ae[o][e],r.push([e,o]));return r[randomInt(r.length)]}function x(){const e=4;return re<Math.trunc(ne/e)?b():re<Math.trunc(2*ne/e)?b():re<Math.trunc(3*ne/e)?y():M()}const g=document.querySelectorAll("div#template-area > svg.cell"),w=document.querySelectorAll("div#template-area > svg.highlight"),v=document.querySelectorAll("div#template-area > svg.assist"),q=document.querySelectorAll("div#template-area > span.color-text"),G=Object.freeze({COLOR_NUM:document.querySelector("select#COLOR_NUM"),BOARD_WIDTH:document.querySelector("input#BOARD_WIDTH"),BOARD_HEIGHT:document.querySelector("input#BOARD_HEIGHT"),AI_LIST:document.querySelectorAll("ul#AI_LIST input"),AI_LEVEL:document.querySelector("select#AI_LEVEL"),DELAY_MSEC:document.querySelector("select#DELAY_MSEC"),LUCKY_MODE:document.querySelector("input#LUCKY_MODE"),HAND_MODE:document.querySelector("input#HAND_MODE")}),$=document.querySelector("button#enter"),k=document.querySelector("div#board"),Y=document.querySelector("button#assist"),K=document.querySelector("button#hint"),V=document.querySelector("button#reset"),j=document.querySelector("div#turn"),z=document.querySelector("div#message"),P=document.querySelector("div#wait"),F=document.querySelector("div#result"),J=document.querySelector("div#log"),Q=Object.freeze({COLOR_NUM:2,BOARD_WIDTH:8,BOARD_HEIGHT:8,AI_LIST:[],AI_LEVEL:3,DELAY_MSEC:500,LUCKY_MODE:!1,HAND_MODE:!1});let X=structuredClone(Q);const Z=Object.freeze([...q].map(e=>e.textContent.toUpperCase())),ee=Object.freeze(createEnum(...Z));let te=0,ne=0,re=0,oe=[],ae=[],ce=[],se=[],ie=[],Te=0,le=!1,de=!1,Ee=!1,ue=!1,Se=!1,Ae=!1,He=!1,Oe="",Le=0,fe={};e()});