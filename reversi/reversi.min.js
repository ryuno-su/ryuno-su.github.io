window.addEventListener("DOMContentLoaded",()=>{"use strict";function e(){const e=document.querySelector("details#parameter-area");let r=!1;setMobileDevice(),scroll(0,0),o(),t(),e.addEventListener("input",()=>{n(),Ee||(Ee=!0,Ae=!0,K.disabled=!0,V.disabled=!0)}),G.addEventListener("click",async()=>{await T()}),k.addEventListener("click",()=>{const e=G.disabled&&!ue;e&&!confirm("Realy reset?")||(t(),e&&(console.log("This game was reset."),z.textContent="This game was reset."))}),K.addEventListener("click",async()=>{Ee||(Ee=!0,await T()),d(ie,!Te)}),V.addEventListener("click",async()=>{Ee||(Ee=!0,await T()),E(!de)}),e.addEventListener("focusin",e=>{const t=e.target.matches('input:is([type="text"], [type="number"]), textarea');t&&(r=!0)}),e.addEventListener("focusout",()=>{r=!1}),window.addEventListener("keyup",t=>{if(r)return;const n=new Event("click");switch(t.key){case"e":G.disabled||G.dispatchEvent(n);break;case"r":k.disabled||k.dispatchEvent(n);break;case"p":e.open=!e.open;break;case"/":const o=document.querySelector(":is(input, textarea, button, select):not(:disabled)"),r=o.parentNode;r.matches("details")&&(r.open=!0),o.focus();break;case"a":K.disabled||K.dispatchEvent(n);break;case"h":V.disabled||V.dispatchEvent(n);break;case"Escape":Te&&d(ie,!1),de&&E(!1)}}),window.addEventListener("beforeunload",e=>{if(G.disabled&&!ue)return e.preventDefault(),e.returnValue="",""})}function t(){clearInterval(Le),j.classList.replace("hidden","shown"),z.classList.replace("hidden","shown"),P.classList.replace("shown","hidden"),F.classList.replace("shown","hidden"),J.classList.replace("shown","hidden"),n(),Ee=!1,Ae=!1;for(let[e,t]of Object.entries(q))"AI_LIST"!==e&&(t.matches("option")&&(t=t.parentNode),t.disabled=!1);q.AI_LIST.forEach(e=>{e.disabled=!1});const e=document.querySelector("ul#AI_LIST");e.classList.remove("disabled"),G.disabled=!1}function n(){r()&&(c(),X.HAND_MODE||s(),a(),l(),i(),Object.freeze(ce),Object.freeze(ae),Object.freeze(le))}function o(){for(let[e,t]of Object.entries(q))if("AI_LIST"!==e){if(t.matches("select")){let n=0;"AI_LEVEL"===e&&(n=Q[e]),"DELAY_MSEC"===e&&(n=3),t=t.options[n],t.selected=!0,t.textContent=String(Q[e]),"DELAY_MSEC"===e&&(t.textContent+="ms")}t.matches('input[type="checkbox"]')&&(t.checked=Q[e]),t.value=Q[e]}for(const e of q.AI_LIST)e.checked=!1;for(const e of Q.AI_LIST)q.AI_LIST[e-1].checked=!0}function r(){let e=!0;const t=/^([1-9][0-9]*|0)$/;for(let[n,o]of Object.entries(q)){const r=Number(o.value);let c=Number(o.min),s=Number(o.max),a=o.title;const l=o.validity;if("AI_LIST"!==n)if(o.matches("select"))X[n]=r;else{if(o.matches("input")){if(o.matches('[type="checkbox"]')){X[n]=o.checked;continue}c=2*Math.trunc(Math.log2(X.COLOR_NUM-1))+4,a=`${c}以上${s}以下の整数を入力してください`}o.setCustomValidity(""),l.valid&&t.test(String(r))&&c<=r&&r<=s?X[n]=r:(e=!1,o.setCustomValidity("invalid"),l.badInput?o.setCustomValidity("invalid: badInput"):l.valueMissing?o.setCustomValidity("invalid: valueMissing"):l.rangeOverflow||r>s?o.setCustomValidity("invalid: rangeOverflow"):l.rangeUnderflow||r<c?o.setCustomValidity("invalid: rangeUnderflow"):l.stepMismatch&&o.setCustomValidity("invalid: stepMismatch")),o.reportValidity(),o.min=String(c),o.max=String(s),o.title=a}}X.AI_LIST=[];for(let e=0;e<q.AI_LIST.length;e++){const t=q.AI_LIST[e].parentNode;t.classList.replace("hidden","shown"),e>=X.COLOR_NUM&&(t.classList.replace("shown","hidden"),q.AI_LIST[e].checked=!1),q.AI_LIST[e].checked&&X.AI_LIST.push(e+1)}const n=q.AI_LEVEL.parentNode;return n.classList.replace("hidden","shown"),0===X.AI_LIST.length&&n.classList.replace("shown","hidden"),G.disabled=!e,e}function c(){z.textContent="",F.textContent="",J.textContent="",re=new Array(X.BOARD_HEIGHT+2);for(let e=0;e<X.BOARD_HEIGHT+2;e++)re[e]=new Array(X.BOARD_WIDTH+2).fill(ee.NONE);ce=structuredClone(re),se=structuredClone(re),ae=structuredClone(re),le=structuredClone(re),He=!1,X.AI_LIST.length===X.COLOR_NUM&&(He=!0,X.COLOR_NUM++),te=Math.trunc(X.BOARD_WIDTH+X.BOARD_HEIGHT)/2,ne=X.BOARD_WIDTH*X.BOARD_HEIGHT+te,oe=0,ie=ee.BLACK;const e=j.querySelector("span.color-text"),t=$[ie].cloneNode(!0);e.replaceWith(t),Te=!1,de=!1,ue=!1,Se=!1,Oe="",fe=(()=>{const e=Math.trunc(X.BOARD_WIDTH/2),t=Math.trunc(X.BOARD_HEIGHT/2),n=Number(q.BOARD_WIDTH.min)-2,o=Number(q.BOARD_HEIGHT.min)-2;return Object.freeze({WEST:e-Math.trunc(n/2)+1,EAST:e-Math.trunc(n/2)+n,NORTH:t-Math.trunc(o/2)+1,SOUTH:t-Math.trunc(o/2)+o})})()}function s(){let e=X.COLOR_NUM;He&&e--;const t=Object.freeze({WEST:Math.trunc(X.BOARD_WIDTH/2),EAST:Math.trunc(X.BOARD_WIDTH/2)+1,NORTH:Math.trunc(X.BOARD_HEIGHT/2),SOUTH:Math.trunc(X.BOARD_HEIGHT/2)+1});switch(e){case 2:re[t.NORTH][t.WEST]=ee.WHITE,re[t.NORTH][t.EAST]=ee.BLACK,re[t.SOUTH][t.WEST]=ee.BLACK,re[t.SOUTH][t.EAST]=ee.WHITE;break;case 3:re[t.NORTH-1][t.WEST]=ee.BLACK,re[t.NORTH][t.WEST-1]=ee.RED,re[t.NORTH][t.WEST]=ee.WHITE,re[t.NORTH-1][t.EAST]=ee.RED,re[t.NORTH][t.EAST]=ee.BLACK,re[t.NORTH][t.EAST+1]=ee.WHITE,re[t.SOUTH][t.WEST-1]=ee.WHITE,re[t.SOUTH][t.WEST]=ee.BLACK,re[t.SOUTH+1][t.WEST]=ee.RED,re[t.SOUTH][t.EAST]=ee.RED,re[t.SOUTH][t.EAST+1]=ee.BLACK,re[t.SOUTH+1][t.EAST]=ee.WHITE;break;case 4:re[t.NORTH-1][t.WEST]=ee.BLACK,re[t.NORTH][t.WEST]=ee.WHITE,re[t.NORTH][t.EAST]=ee.BLACK,re[t.NORTH][t.EAST+1]=ee.BLUE,re[t.SOUTH][t.WEST-1]=ee.WHITE,re[t.SOUTH][t.WEST]=ee.RED,re[t.SOUTH][t.EAST]=ee.BLUE,re[t.SOUTH+1][t.EAST]=ee.RED;break;case 5:re[t.NORTH-2][t.WEST]=ee.CYAN,re[t.NORTH-1][t.WEST-1]=ee.BLUE,re[t.NORTH-1][t.WEST]=ee.BLACK,re[t.NORTH][t.WEST-1]=ee.RED,re[t.NORTH][t.WEST]=ee.WHITE,re[t.NORTH-1][t.EAST]=ee.WHITE,re[t.NORTH-1][t.EAST+1]=ee.RED,re[t.NORTH][t.EAST]=ee.BLACK,re[t.NORTH][t.EAST+1]=ee.CYAN,re[t.NORTH][t.EAST+2]=ee.BLUE,re[t.SOUTH][t.WEST-2]=ee.BLACK,re[t.SOUTH][t.WEST-1]=ee.WHITE,re[t.SOUTH][t.WEST]=ee.RED,re[t.SOUTH+1][t.WEST-1]=ee.CYAN,re[t.SOUTH+1][t.WEST]=ee.BLUE,re[t.SOUTH][t.EAST]=ee.BLUE,re[t.SOUTH][t.EAST+1]=ee.CYAN,re[t.SOUTH+1][t.EAST]=ee.RED,re[t.SOUTH+1][t.EAST+1]=ee.BLACK,re[t.SOUTH+2][t.EAST]=ee.WHITE;break;case 6:re[t.NORTH-2][t.WEST-1]=ee.CYAN,re[t.NORTH-2][t.WEST]=ee.MAGENTA,re[t.NORTH-1][t.WEST-1]=ee.BLUE,re[t.NORTH-1][t.WEST]=ee.BLACK,re[t.NORTH][t.WEST-1]=ee.RED,re[t.NORTH][t.WEST]=ee.WHITE,re[t.NORTH-1][t.EAST]=ee.WHITE,re[t.NORTH-1][t.EAST+1]=ee.RED,re[t.NORTH-1][t.EAST+2]=ee.BLUE,re[t.NORTH][t.EAST]=ee.BLACK,re[t.NORTH][t.EAST+1]=ee.MAGENTA,re[t.NORTH][t.EAST+2]=ee.CYAN,re[t.SOUTH][t.WEST-2]=ee.BLACK,re[t.SOUTH][t.WEST-1]=ee.WHITE,re[t.SOUTH][t.WEST]=ee.RED,re[t.SOUTH+1][t.WEST-2]=ee.MAGENTA,re[t.SOUTH+1][t.WEST-1]=ee.CYAN,re[t.SOUTH+1][t.WEST]=ee.BLUE,re[t.SOUTH][t.EAST]=ee.BLUE,re[t.SOUTH][t.EAST+1]=ee.CYAN,re[t.SOUTH+1][t.EAST]=ee.RED,re[t.SOUTH+1][t.EAST+1]=ee.MAGENTA,re[t.SOUTH+2][t.EAST]=ee.WHITE,re[t.SOUTH+2][t.EAST+1]=ee.BLACK;break;case 7:re[t.NORTH-2][t.WEST]=ee.YELLOW,re[t.NORTH-1][t.WEST-2]=ee.CYAN,re[t.NORTH-1][t.WEST-1]=ee.MAGENTA,re[t.NORTH-1][t.WEST]=ee.BLACK,re[t.NORTH][t.WEST-2]=ee.BLUE,re[t.NORTH][t.WEST-1]=ee.RED,re[t.NORTH][t.WEST]=ee.WHITE,re[t.NORTH-2][t.EAST]=ee.RED,re[t.NORTH-2][t.EAST+1]=ee.BLUE,re[t.NORTH-1][t.EAST]=ee.WHITE,re[t.NORTH-1][t.EAST+1]=ee.CYAN,re[t.NORTH][t.EAST]=ee.BLACK,re[t.NORTH][t.EAST+1]=ee.YELLOW,re[t.NORTH][t.EAST+2]=ee.MAGENTA,re[t.SOUTH][t.WEST-2]=ee.BLACK,re[t.SOUTH][t.WEST-1]=ee.WHITE,re[t.SOUTH][t.WEST]=ee.RED,re[t.SOUTH+1][t.WEST-1]=ee.YELLOW,re[t.SOUTH+1][t.WEST]=ee.BLUE,re[t.SOUTH+2][t.WEST-1]=ee.MAGENTA,re[t.SOUTH+2][t.WEST]=ee.CYAN,re[t.SOUTH][t.EAST]=ee.BLUE,re[t.SOUTH][t.EAST+1]=ee.CYAN,re[t.SOUTH][t.EAST+1]=ee.MAGENTA,re[t.SOUTH+1][t.EAST]=ee.RED,re[t.SOUTH+1][t.EAST+1]=ee.BLACK,re[t.SOUTH+1][t.EAST+2]=ee.YELLOW,re[t.SOUTH+2][t.EAST]=ee.WHITE;break;default:exit()}}function a(){const e=X.BOARD_WIDTH,t=X.BOARD_HEIGHT,n=e>t?e:t,o=e<=t?e:t,r=Math.trunc(n/2),c=Math.trunc(o/2),s=0,a=r+3;for(let n=0;n<=e+1;n++)ce[0][n]=s,ce[t+1][n]=s;for(let n=0;n<=t+1;n++)ce[n][0]=s,ce[n][e+1]=s;const l=a;ce[1][1]=l,ce[1][e]=l,ce[t][1]=l,ce[t][e]=l;const i=l-1;ce[1][3]=i,ce[1][e-2]=i,ce[3][1]=i,ce[3][e]=i,ce[t-2][1]=i,ce[t-2][e]=i,ce[t][3]=i,ce[t][e-2]=i;const T=i-1;for(let n=4;n<=e-3;n++)ce[1][n]=T,ce[t][n]=T;for(let n=4;n<=t-3;n++)ce[n][1]=T,ce[n][e]=T;const d=s+1;ce[1][2]=d,ce[1][e-1]=d,ce[2][1]=d,ce[2][e]=d,ce[t-1][1]=d,ce[t-1][e]=d,ce[t][2]=d,ce[t][e-1]=d;for(let n=2;n<=c;n++){const o=Math.trunc(n/2);let r=n%2==0?o:l-o;r=r===d?d+1:r,ce[n][n]=r,ce[n][e-n+1]=r,ce[t-n+1][n]=r,ce[t-n+1][e-n+1]=r;const c=n%2==0?d+1+o:T-o;for(let o=n+1;o<=e-n;o++)ce[n][o]=c,ce[t-n+1][o]=c;for(let o=n+1;o<=t-n;o++)ce[o][n]=c,ce[o][e-n+1]=c}}function l(){for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)ae[e][t]=1;if(!X.LUCKY_MODE)return;const e=randomIntRange(4,10);console.log(`luckyWeight: ${e}`);const t=X.BOARD_WIDTH*X.BOARD_HEIGHT,n=randomIntRange(1,Math.trunc(t/8));let o=0;for(;o<n;){const t=randomIntRange(1,X.BOARD_WIDTH),n=randomIntRange(1,X.BOARD_HEIGHT);ae[n][t]>1||(ae[n][t]=e,o++)}}function i(){Y.emptyChild();for(let e=1;e<=X.BOARD_HEIGHT;e++){for(let t=1;t<=X.BOARD_WIDTH;t++){const n=w[re[e][t]].cloneNode(!0);n.dataset.index=String(u(t,e)),n.querySelector("text").textContent=String(ce[e][t]),ae[e][t]>1&&n.classList.add("lucky"),X.HAND_MODE&&!O(t,e,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)&&n.classList.add("not-init_area"),n.addEventListener("click",()=>{S(t,e)}),Y.appendChild(n),le[e][t]=Y.querySelector(`svg[data-index="${u(t,e)}"]`)}Y.appendChild(document.createElement("br"))}}async function T(){Ae=!1,K.disabled=!1,V.disabled=!1;for(let[e,t]of Object.entries(q))"AI_LIST"!==e&&(t.matches("option")&&(t=t.parentNode),t.disabled=!0);q.AI_LIST.forEach(e=>{e.disabled=!0});const e=document.querySelector("ul#AI_LIST");e.classList.add("disabled"),G.disabled=!0,console.log("This game was started."),z.textContent="This game was started.",console.log(`COLOR_NUM: ${X.COLOR_NUM}`),console.log(`BOARD_WIDTH: ${X.BOARD_WIDTH}`),console.log(`BOARD_HEIGHT: ${X.BOARD_HEIGHT}`),console.log(`AI_LIST: ${0===X.AI_LIST.length?Z[0]:X.AI_LIST.map(e=>Z[e])}`),console.log(`AI_LEVEL: ${0===X.AI_LIST.length?Z[0]:X.AI_LEVEL}`),console.log(`DELAY_MSEC: ${X.DELAY_MSEC}ms`),console.log(`LUCKY_MODE: ${X.LUCKY_MODE}`),console.log(`HAND_MODE: ${X.HAND_MODE}`),await p()}function d(e=ie,t=!0){const n=v[e].cloneNode(!0),o=n.getAttribute("class");for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let r=1;r<=X.BOARD_WIDTH;r++){const c=le[e][r];if(t){if(!A(r,e))continue;c.setAttribute("class",o),c.dataset.color=n.dataset.color,c.innerHTML=n.innerHTML}else{const t=w[re[e][r]].cloneNode(!0),n=c.getAttribute("class"),s=t.getAttribute("class");if(n!==o)continue;c.setAttribute("class",s),c.dataset.color=t.dataset.color,c.innerHTML=t.innerHTML}const s=c.querySelector("text");s.textContent=String(ce[e][r]),de&&s.classList.replace("hidden","shown")}return Te=t}function E(e=!0){const t=Y.querySelectorAll("svg > text");return t.forEach(t=>{e?t.classList.replace("hidden","shown"):t.classList.replace("shown","hidden")}),de=e}function u(e,t,n=X.BOARD_WIDTH){const o=n+2,r=t*o+e;return r}async function S(e,t){if(!(ue||Ae||Se)){if(Ee||(Ee=!0,await T()),z.textContent="",!A(e,t,ie,!0))return z.appendChild(document.createTextNode("Cannot put ")),z.appendChild($[ie].cloneNode(!0)),void z.appendChild(document.createTextNode(" here."));await h(),await p()}}function A(e,t,n=ie,o=!1,r=!0){const c=le[t][e];let s=0;if(!O(e,t))return 0;const a=r?re[t][e]:se[t][e];if(a>ee.NONE)return 0;if(X.HAND_MODE){if(O(e,t,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)){if(o)if(r){f(),I(e,t,n);const o=`${String.fromCharCode(e-1+"A".charCodeAt(0))}${t}`;console.log(`turn: ${Z[n]}, x: ${e}, y: ${t}, xy: ${o}`),Oe+=o,L(e,t,n,!0),c.querySelector("rect.highlight-stone").classList.add("highlight-put")}else se[t][e]=n;return 1}return 0}let l=!0;for(let a=-1;a<=1;a++)for(let i=-1;i<=1;i++){if(0===i&&0===a)continue;let T=e+i,d=t+a,E=0,u=r?re[d][T]:se[d][T];for(;u!==n&&u!==ee.NONE;)T+=i,d+=a,E++,u=r?re[d][T]:se[d][T];if(0!==E&&u!==ee.NONE&&(s+=E,o)){if(l)if(r){l=!1,f(),I(e,t,n);const o=`${String.fromCharCode(e-1+"A".charCodeAt(0))}${t}`;console.log(`turn: ${Z[n]}, x: ${e}, y: ${t}, xy: ${o}`),Oe+=o,L(e,t,n,!0),c.querySelector("rect.highlight-stone").classList.add("highlight-put")}else se[t][e]=n;for(T=e+i,d=t+a;E>0;)r?(I(T,d,n),L(T,d,n,!0)):se[d][T]=n,T+=i,d+=a,E--}}return s}function H(e=ie){for(let t=1;t<=X.BOARD_HEIGHT;t++)for(let n=1;n<=X.BOARD_WIDTH;n++)if(A(n,t,e))return!0;return!1}function O(e,t,n=1,o=X.BOARD_WIDTH,r=1,c=X.BOARD_HEIGHT){const s=n<=e&&e<=o,a=r<=t&&t<=c;return s&&a}function L(e,t,n=ie,o=!0){if(!O(e,t))return;const r=le[t][e],c=w[re[t][e]].cloneNode(!0),s=x[n].cloneNode(!0),a=c.getAttribute("class"),l=s.getAttribute("class");return o?(r.setAttribute("class",l),r.dataset.color=s.dataset.color,r.innerHTML=s.innerHTML):(r.setAttribute("class",a),r.dataset.color=c.dataset.color,r.innerHTML=c.innerHTML),r.querySelector("text").textContent=String(ce[t][e]),ae[t][e]>1&&r.classList.add("lucky"),X.HAND_MODE&&!O(e,t,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)&&r.classList.add("not-init_area"),o}function f(){for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)L(t,e,ie,!1)}function I(e,t,n=ie){if(!O(e,t))return;re[t][e]=n;const o=le[t][e],r=w[n].cloneNode(!0);o.dataset.color=r.dataset.color,o.innerHTML=r.innerHTML,o.querySelector("text").textContent=String(ce[t][e]),ae[t][e]>1&&r.classList.add("lucky"),X.HAND_MODE&&!O(e,t,fe.WEST,fe.EAST,fe.NORTH,fe.SOUTH)&&r.classList.add("not-init_area")}async function h(){let e=R(ie);if(e&&Se||oe++,X.HAND_MODE){let e=X.COLOR_NUM;He&&e--;const t=2,n=oe<e*t;if(!n)for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++){const n=le[e][t];(t<fe.WEST||fe.EAST<t||e<fe.NORTH||fe.SOUTH<e)&&n.classList.remove("not-init_area")}X.HAND_MODE=n}if(ue=_(),ue)return;Te&&d(ie,!1),de&&E(!1),ie=D(ie);const t=j.querySelector("span.color-text"),n=$[ie].cloneNode(!0);t.replaceWith(n),e=R(ie),Se=!!e||!H(ie),Se&&(e||(z.appendChild(document.createTextNode("Cannot put ")),z.appendChild($[ie].cloneNode(!0)),z.appendChild(document.createTextNode(" any position. ")),z.appendChild($[ie].cloneNode(!0)),z.appendChild(document.createTextNode(" is passed.")),console.log(`turn: ${Z[ie]}, pass`),K.disabled=!0,V.disabled=!0,await C(X.DELAY_MSEC),K.disabled=!1,V.disabled=!1),await h(),await p())}function R(e=ie){return He&&!X.AI_LIST.includes(e)}function D(e=ie,t=X.COLOR_NUM){return(e+t)%t+1}function N(e=ie){let t=0;for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let o=1;o<=X.BOARD_WIDTH;o++)re[n][o]===e&&(t+=ae[n][o]);return t}function _(){let e=X.COLOR_NUM;for(let t=ee.NONE+1;t<=e;t++)if(H(t))return!1;const t=new Array(e+1).fill(0);for(let n=ee.NONE;n<=e;n++)t[n]=N(n);let n="";F.textContent="";let o=!0,r=0,c=ee.NONE;He&&e--;for(let s=ee.NONE+1;s<=e;s++)n+=`${Z[s]}=${t[s]}, `,F.appendChild($[s].cloneNode(!0)),F.appendChild(document.createTextNode(`=${t[s]}, `)),t[s]!==t[e]&&(o=!1),r<t[s]&&(r=t[s],c=s);return o?(n+="draw.",F.appendChild(document.createTextNode("draw."))):(n+=`${Z[c]} won.`,F.appendChild($[c].cloneNode(!0)),F.appendChild(document.createTextNode(" won."))),z.textContent="This game was over.",J.textContent=Oe,j.classList.replace("shown","hidden"),z.classList.replace("hidden","shown"),F.classList.replace("hidden","shown"),J.classList.replace("hidden","shown"),f(),d(ie,!1),E(!1),K.disabled=!0,V.disabled=!0,console.log("This game was over."),console.log(`result: ${n}`),console.log(`record: ${Oe}`),!0}function C(e){if(e<=0)return new Promise(e=>{e()});if(!Ae){const t=2;e*=t}const t=P.querySelector("progress#progress"),n=P.querySelector('label[for="progress"]'),o=P.querySelector('output[for="progress"]');let r=0;n.textContent=Ae&&!Se?"AI thinking ...":"Please wait ...",t.value=`${r}`,t.textContent=`${r}%`,o.textContent=`${r}%`,P.classList.replace("hidden","shown");let c=Math.max(e/Number(t.max),4),s=Math.trunc(Number(t.max)/(e/c));return new Promise(e=>{Le=setInterval(()=>{r+=s,t.value=`${r}`,t.textContent=`${r}%`,o.textContent=`${r}%`,r>=Number(t.max)&&(P.classList.replace("shown","hidden"),clearInterval(Le),e())},c)})}async function p(){for(const e of X.AI_LIST)await W()}async function W(){if(console.group("AIPut"),console.log(`turn = ${ie}, ${Z[ie]}`),!X.AI_LIST.includes(ie))return;if(ue)return;Ae=!0,K.disabled=!0,V.disabled=!0,await C(X.DELAY_MSEC);const[e,t]=m(X.AI_LEVEL);A(e,t,ie,!0),z.textContent="",Ae=!1,K.disabled=!1,V.disabled=!1,await h(),console.groupEnd("AIPut")}function m(e=0){switch(e){case 0:return B();case 1:return U();case 2:return b();case 3:return M();case 4:return g();case 5:return y();default:exit()}}function B(){for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)if(A(t,e))return[t,e]}function U(){let e=[];for(let t=1;t<=X.BOARD_HEIGHT;t++)for(let n=1;n<=X.BOARD_WIDTH;n++)A(n,t)&&e.push([n,t]);return e[randomInt(e.length)]}function b(){let e=1,t=[];for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let o=1;o<=X.BOARD_WIDTH;o++){let r=A(o,n);e<=r&&(e<r&&(t=[]),e=r,t.push([o,n]))}return t[randomInt(t.length)]}function M(){let e=ce[0][0]-1,t=[];for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let o=1;o<=X.BOARD_WIDTH;o++)A(o,n)&&e<=ce[n][o]&&(e<ce[n][o]&&(t=[]),e=ce[n][o],t.push([o,n]));return t[randomInt(t.length)]}function g(){let e=ce[1][1]+1,t=[];for(let n=1;n<=X.BOARD_HEIGHT;n++)for(let o=1;o<=X.BOARD_WIDTH;o++){if(se=structuredClone(re),!A(o,n,ie,!0,!1))continue;let r=ce[0][0]-1;for(let e=1;e<=X.BOARD_HEIGHT;e++)for(let t=1;t<=X.BOARD_WIDTH;t++)A(t,e,D(ie),!1,!1)&&(r=Math.max(r,ce[e][t]));e>=r&&(e>r&&(t=[]),e=r,t.push([o,n]))}let n=ce[0][0],o=[];for(const[e,r]of t)n<=ce[r][e]&&(n<ce[r][e]&&(o=[]),n=ce[r][e],o.push([e,r]));return o[randomInt(o.length)]}function y(){const e=4;return oe<Math.trunc(ne/e)?M():oe<Math.trunc(2*ne/e)?M():oe<Math.trunc(3*ne/e)?g():b()}const w=document.querySelectorAll("div#template-area > svg.cell"),x=document.querySelectorAll("div#template-area > svg.highlight"),v=document.querySelectorAll("div#template-area > svg.assist"),$=document.querySelectorAll("div#template-area > span.color-text"),q=Object.freeze({COLOR_NUM:document.querySelector("select#COLOR_NUM"),BOARD_WIDTH:document.querySelector("input#BOARD_WIDTH"),BOARD_HEIGHT:document.querySelector("input#BOARD_HEIGHT"),AI_LIST:document.querySelectorAll("ul#AI_LIST input"),AI_LEVEL:document.querySelector("select#AI_LEVEL"),DELAY_MSEC:document.querySelector("select#DELAY_MSEC"),LUCKY_MODE:document.querySelector("input#LUCKY_MODE"),HAND_MODE:document.querySelector("input#HAND_MODE")}),G=document.querySelector("button#enter"),k=document.querySelector("button#reset"),Y=document.querySelector("div#board"),K=document.querySelector("button#assist"),V=document.querySelector("button#hint"),j=document.querySelector("div#turn"),z=document.querySelector("div#message"),P=document.querySelector("div#wait"),F=document.querySelector("div#result"),J=document.querySelector("div#record"),Q=Object.freeze({COLOR_NUM:2,BOARD_WIDTH:8,BOARD_HEIGHT:8,AI_LIST:[],AI_LEVEL:3,DELAY_MSEC:500,LUCKY_MODE:!1,HAND_MODE:!1});let X=structuredClone(Q);const Z=Object.freeze([...$].map(e=>e.textContent.toUpperCase())),ee=Object.freeze(createEnum(...Z));let te=0,ne=0,oe=0,re=[],ce=[],se=[],ae=[],le=[],ie=0,Te=!1,de=!1,Ee=!1,ue=!1,Se=!1,Ae=!1,He=!1,Oe="",Le=0,fe={};e()});