window.addEventListener("DOMContentLoaded",async()=>{"use strict";function e(){const e=document.querySelector("details#parameter-area"),o=document.querySelector("details#log-area");let c=!1;g.setMobileDevice(),r(),t(),e.addEventListener("input",()=>{n(),Ae||(Ae=!0,Oe=!0,K.disabled=!0,V.disabled=!0)}),k.addEventListener("click",async()=>{await T()}),K.addEventListener("click",async()=>{Ae||(Ae=!0,await T()),d(de,!ue)}),V.addEventListener("click",async()=>{Ae||(Ae=!0,await T()),u(!Ee)}),j.addEventListener("click",()=>{const e=k.disabled&&!He;e&&!window.confirm("Realy reset?")||(t(),e&&(P.textContent="This game was reset.",Q.textContent+="This game was reset.\n",Q.scroll(0,Q.scrollHeight)))}),e.addEventListener("focusin",e=>{const t=e.target.matches('input:is([type="text"], [type="number"]), textarea');t&&(c=!0)}),e.addEventListener("focusout",()=>{c=!1}),window.addEventListener("keyup",t=>{if(c)return;const n=new Event("click");switch(t.key){case"e":k.disabled||k.dispatchEvent(n);break;case"r":j.disabled||j.dispatchEvent(n);break;case"p":e.open=!e.open;break;case"l":o.open=!o.open;break;case"/":const r=document.querySelector(":is(input, textarea, button, select):not(:disabled)"),c=r.parentNode;c.matches("details")&&(c.open=!0),r.focus();break;case"a":K.disabled||K.dispatchEvent(n);break;case"h":V.disabled||V.dispatchEvent(n);break;case"Escape":ue&&d(de,!1),Ee&&u(!1)}}),window.addEventListener("beforeunload",e=>{if(k.disabled&&!He)return e.preventDefault(),e.returnValue="",""})}function t(){window.clearInterval(Ie),z.classList.replace("hidden","shown"),P.classList.replace("hidden","shown"),F.classList.replace("shown","hidden"),J.classList.replace("shown","hidden"),n(),Ae=!1,Oe=!1,document.documentElement.scroll(0,0);for(let[e,t]of Object.entries($))"AI_LIST"!==e&&(t.matches("option")&&(t=t.parentNode),t.disabled=!1);$.AI_LIST.forEach(e=>{e.disabled=!1});const e=document.querySelector("ul#AI_LIST");e.classList.remove("disabled"),k.disabled=!1}function n(){o()&&(c(),Z.HAND_MODE||a(),s(),l(),i(),Object.freeze(se),Object.freeze(ie),Object.freeze(Te))}function r(){for(let[e,t]of Object.entries($))if("AI_LIST"!==e){if(t.matches("select")){let n=0;"AI_LEVEL"===e&&(n=X[e]),"DELAY_MSEC"===e&&(n=3),t=t.options[n],t.selected=!0,t.textContent=String(X[e]),"DELAY_MSEC"===e&&(t.textContent+="ms")}t.matches('input[type="checkbox"]')&&(t.checked=X[e]),t.value=X[e]}for(const e of $.AI_LIST)e.checked=!1;for(const e of X.AI_LIST)$.AI_LIST[e-1].checked=!0}function o(){let e=!0;const t=/^([1-9][0-9]*|0)$/;for(let[n,r]of Object.entries($)){const o=Number(r.value);let c=Number(r.min),a=Number(r.max),s=r.title;const l=r.validity;if("AI_LIST"!==n)if(r.matches("select"))Z[n]=o;else{if(r.matches("input")){if(r.matches('[type="checkbox"]')){Z[n]=r.checked;continue}c=2*Math.trunc(Math.log2(Z.COLOR_NUM-1))+4,s=`${c}以上${a}以下の整数を入力してください`}r.setCustomValidity(""),l.valid&&t.test(String(o))&&c<=o&&o<=a?Z[n]=o:(e=!1,r.setCustomValidity("invalid"),l.badInput?r.setCustomValidity("invalid: badInput"):l.valueMissing?r.setCustomValidity("invalid: valueMissing"):l.rangeOverflow||o>a?r.setCustomValidity("invalid: rangeOverflow"):l.rangeUnderflow||o<c?r.setCustomValidity("invalid: rangeUnderflow"):l.stepMismatch&&r.setCustomValidity("invalid: stepMismatch")),r.reportValidity(),r.min=String(c),r.max=String(a),r.title=s}}Z.AI_LIST=[];for(let e=0;e<$.AI_LIST.length;e++){const t=$.AI_LIST[e].parentNode;t.classList.replace("hidden","shown"),e>=Z.COLOR_NUM&&(t.classList.replace("shown","hidden"),$.AI_LIST[e].checked=!1),$.AI_LIST[e].checked&&Z.AI_LIST.push(e+1)}const n=$.AI_LEVEL.parentNode;return n.classList.replace("hidden","shown"),0===Z.AI_LIST.length&&n.classList.replace("shown","hidden"),k.disabled=!e,e}function c(){P.emptyChild(),J.emptyChild(),ae=new Array(Z.BOARD_HEIGHT+2);for(let e=0;e<Z.BOARD_HEIGHT+2;e++)ae[e]=new Array(Z.BOARD_WIDTH+2).fill(te.NONE);se=window.structuredClone(ae),le=window.structuredClone(ae),ie=window.structuredClone(ae),Te=window.structuredClone(ae),Le=!1,ne=Z.COLOR_NUM,Z.AI_LIST.length===Z.COLOR_NUM&&(Le=!0,ne++),re=Math.trunc(Z.BOARD_WIDTH+Z.BOARD_HEIGHT)/2,oe=Z.BOARD_WIDTH*Z.BOARD_HEIGHT+re,ce=0,de=te.BLACK;const e=z.querySelector("span.color-text"),t=G[de].cloneNode(!0);e.replaceWith(t),ue=!1,Ee=!1,He=!1,Se=!1,fe="",Ie=0,he=(()=>{const e=Math.trunc(Z.BOARD_WIDTH/2),t=Math.trunc(Z.BOARD_HEIGHT/2),n=Number($.BOARD_WIDTH.min)-2,r=Number($.BOARD_HEIGHT.min)-2;return Object.freeze({WEST:e-Math.trunc(n/2)+1,EAST:e-Math.trunc(n/2)+n,NORTH:t-Math.trunc(r/2)+1,SOUTH:t-Math.trunc(r/2)+r})})()}function a(){const e=Object.freeze({WEST:Math.trunc(Z.BOARD_WIDTH/2),EAST:Math.trunc(Z.BOARD_WIDTH/2)+1,NORTH:Math.trunc(Z.BOARD_HEIGHT/2),SOUTH:Math.trunc(Z.BOARD_HEIGHT/2)+1});switch(Z.COLOR_NUM){case 2:ae[e.NORTH][e.WEST]=te.WHITE,ae[e.NORTH][e.EAST]=te.BLACK,ae[e.SOUTH][e.WEST]=te.BLACK,ae[e.SOUTH][e.EAST]=te.WHITE;break;case 3:ae[e.NORTH-1][e.WEST]=te.BLACK,ae[e.NORTH][e.WEST-1]=te.RED,ae[e.NORTH][e.WEST]=te.WHITE,ae[e.NORTH-1][e.EAST]=te.RED,ae[e.NORTH][e.EAST]=te.BLACK,ae[e.NORTH][e.EAST+1]=te.WHITE,ae[e.SOUTH][e.WEST-1]=te.WHITE,ae[e.SOUTH][e.WEST]=te.BLACK,ae[e.SOUTH+1][e.WEST]=te.RED,ae[e.SOUTH][e.EAST]=te.RED,ae[e.SOUTH][e.EAST+1]=te.BLACK,ae[e.SOUTH+1][e.EAST]=te.WHITE;break;case 4:ae[e.NORTH-1][e.WEST]=te.BLACK,ae[e.NORTH][e.WEST]=te.WHITE,ae[e.NORTH][e.EAST]=te.BLACK,ae[e.NORTH][e.EAST+1]=te.BLUE,ae[e.SOUTH][e.WEST-1]=te.WHITE,ae[e.SOUTH][e.WEST]=te.RED,ae[e.SOUTH][e.EAST]=te.BLUE,ae[e.SOUTH+1][e.EAST]=te.RED;break;case 5:ae[e.NORTH-2][e.WEST]=te.CYAN,ae[e.NORTH-1][e.WEST-1]=te.BLUE,ae[e.NORTH-1][e.WEST]=te.BLACK,ae[e.NORTH][e.WEST-1]=te.RED,ae[e.NORTH][e.WEST]=te.WHITE,ae[e.NORTH-1][e.EAST]=te.WHITE,ae[e.NORTH-1][e.EAST+1]=te.RED,ae[e.NORTH][e.EAST]=te.BLACK,ae[e.NORTH][e.EAST+1]=te.CYAN,ae[e.NORTH][e.EAST+2]=te.BLUE,ae[e.SOUTH][e.WEST-2]=te.BLACK,ae[e.SOUTH][e.WEST-1]=te.WHITE,ae[e.SOUTH][e.WEST]=te.RED,ae[e.SOUTH+1][e.WEST-1]=te.CYAN,ae[e.SOUTH+1][e.WEST]=te.BLUE,ae[e.SOUTH][e.EAST]=te.BLUE,ae[e.SOUTH][e.EAST+1]=te.CYAN,ae[e.SOUTH+1][e.EAST]=te.RED,ae[e.SOUTH+1][e.EAST+1]=te.BLACK,ae[e.SOUTH+2][e.EAST]=te.WHITE;break;case 6:ae[e.NORTH-2][e.WEST-1]=te.CYAN,ae[e.NORTH-2][e.WEST]=te.MAGENTA,ae[e.NORTH-1][e.WEST-1]=te.BLUE,ae[e.NORTH-1][e.WEST]=te.BLACK,ae[e.NORTH][e.WEST-1]=te.RED,ae[e.NORTH][e.WEST]=te.WHITE,ae[e.NORTH-1][e.EAST]=te.WHITE,ae[e.NORTH-1][e.EAST+1]=te.RED,ae[e.NORTH-1][e.EAST+2]=te.BLUE,ae[e.NORTH][e.EAST]=te.BLACK,ae[e.NORTH][e.EAST+1]=te.MAGENTA,ae[e.NORTH][e.EAST+2]=te.CYAN,ae[e.SOUTH][e.WEST-2]=te.BLACK,ae[e.SOUTH][e.WEST-1]=te.WHITE,ae[e.SOUTH][e.WEST]=te.RED,ae[e.SOUTH+1][e.WEST-2]=te.MAGENTA,ae[e.SOUTH+1][e.WEST-1]=te.CYAN,ae[e.SOUTH+1][e.WEST]=te.BLUE,ae[e.SOUTH][e.EAST]=te.BLUE,ae[e.SOUTH][e.EAST+1]=te.CYAN,ae[e.SOUTH+1][e.EAST]=te.RED,ae[e.SOUTH+1][e.EAST+1]=te.MAGENTA,ae[e.SOUTH+2][e.EAST]=te.WHITE,ae[e.SOUTH+2][e.EAST+1]=te.BLACK;break;case 7:ae[e.NORTH-2][e.WEST]=te.YELLOW,ae[e.NORTH-1][e.WEST-2]=te.CYAN,ae[e.NORTH-1][e.WEST-1]=te.MAGENTA,ae[e.NORTH-1][e.WEST]=te.BLACK,ae[e.NORTH][e.WEST-2]=te.BLUE,ae[e.NORTH][e.WEST-1]=te.RED,ae[e.NORTH][e.WEST]=te.WHITE,ae[e.NORTH-2][e.EAST]=te.RED,ae[e.NORTH-2][e.EAST+1]=te.BLUE,ae[e.NORTH-1][e.EAST]=te.WHITE,ae[e.NORTH-1][e.EAST+1]=te.CYAN,ae[e.NORTH][e.EAST]=te.BLACK,ae[e.NORTH][e.EAST+1]=te.YELLOW,ae[e.NORTH][e.EAST+2]=te.MAGENTA,ae[e.SOUTH][e.WEST-2]=te.BLACK,ae[e.SOUTH][e.WEST-1]=te.WHITE,ae[e.SOUTH][e.WEST]=te.RED,ae[e.SOUTH+1][e.WEST-1]=te.YELLOW,ae[e.SOUTH+1][e.WEST]=te.BLUE,ae[e.SOUTH+2][e.WEST-1]=te.MAGENTA,ae[e.SOUTH+2][e.WEST]=te.CYAN,ae[e.SOUTH][e.EAST]=te.BLUE,ae[e.SOUTH][e.EAST+1]=te.CYAN,ae[e.SOUTH][e.EAST+1]=te.MAGENTA,ae[e.SOUTH+1][e.EAST]=te.RED,ae[e.SOUTH+1][e.EAST+1]=te.BLACK,ae[e.SOUTH+1][e.EAST+2]=te.YELLOW,ae[e.SOUTH+2][e.EAST]=te.WHITE;break;default:g.exit()}}function s(){const e=Z.BOARD_WIDTH,t=Z.BOARD_HEIGHT,n=e>t?e:t,r=e<=t?e:t,o=Math.trunc(n/2),c=Math.trunc(r/2),a=0,s=o+3;for(let n=0;n<=e+1;n++)se[0][n]=a,se[t+1][n]=a;for(let n=0;n<=t+1;n++)se[n][0]=a,se[n][e+1]=a;const l=s;se[1][1]=l,se[1][e]=l,se[t][1]=l,se[t][e]=l;const i=l-1;se[1][3]=i,se[1][e-2]=i,se[3][1]=i,se[3][e]=i,se[t-2][1]=i,se[t-2][e]=i,se[t][3]=i,se[t][e-2]=i;const T=i-1;for(let n=4;n<=e-3;n++)se[1][n]=T,se[t][n]=T;for(let n=4;n<=t-3;n++)se[n][1]=T,se[n][e]=T;const d=a+1;se[1][2]=d,se[1][e-1]=d,se[2][1]=d,se[2][e]=d,se[t-1][1]=d,se[t-1][e]=d,se[t][2]=d,se[t][e-1]=d;for(let n=2;n<=c;n++){const r=Math.trunc(n/2);let o=n%2==0?r:l-r;o=o===d?d+1:o,se[n][n]=o,se[n][e-n+1]=o,se[t-n+1][n]=o,se[t-n+1][e-n+1]=o;const c=n%2==0?d+1+r:T-r;for(let r=n+1;r<=e-n;r++)se[n][r]=c,se[t-n+1][r]=c;for(let r=n+1;r<=t-n;r++)se[r][n]=c,se[r][e-n+1]=c}}function l(){for(let e=1;e<=Z.BOARD_HEIGHT;e++)for(let t=1;t<=Z.BOARD_WIDTH;t++)ie[e][t]=1;if(!Z.LUCKY_MODE)return;const e=g.randomIntRange(4,10),t=Z.BOARD_WIDTH*Z.BOARD_HEIGHT,n=g.randomIntRange(1,Math.trunc(t/8));let r=0;for(;r<n;){const t=g.randomIntRange(1,Z.BOARD_WIDTH),n=g.randomIntRange(1,Z.BOARD_HEIGHT);ie[n][t]>1||(ie[n][t]=e,r++)}}function i(){Y.emptyChild();for(let e=1;e<=Z.BOARD_HEIGHT;e++){const t=document.createElement("tr");for(let n=1;n<=Z.BOARD_WIDTH;n++){const r=document.createElement("td"),o=x[ae[e][n]].cloneNode(!0);o.dataset.index=String(E(n,e)),o.querySelector("text").textContent=String(se[e][n]),ie[e][n]>1&&o.classList.add("lucky"),Z.HAND_MODE&&!O(n,e,he)&&o.classList.add("not-init_area"),o.addEventListener("click",()=>{A(n,e)}),r.appendChild(o),t.appendChild(r),Te[e][n]=o}Y.appendChild(t)}}async function T(){Oe=!1,K.disabled=!1,V.disabled=!1;for(let[e,t]of Object.entries($))"AI_LIST"!==e&&(t.matches("option")&&(t=t.parentNode),t.disabled=!0);$.AI_LIST.forEach(e=>{e.disabled=!0});const e=document.querySelector("ul#AI_LIST");e.classList.add("disabled"),k.disabled=!0,P.textContent="This game was started.",Q.textContent+="This game was started.\n",Q.textContent+=`COLOR_NUM: ${Z.COLOR_NUM}\n`,Q.textContent+=`BOARD_WIDTH: ${Z.BOARD_WIDTH}\n`,Q.textContent+=`BOARD_HEIGHT: ${Z.BOARD_HEIGHT}\n`,Q.textContent+=`AI_LIST: ${0===Z.AI_LIST.length?ee[0]:Z.AI_LIST.map(e=>ee[e])}\n`,Q.textContent+=`AI_LEVEL: ${0===Z.AI_LIST.length?ee[0]:Z.AI_LEVEL}\n`,Q.textContent+=`DELAY_MSEC: ${Z.DELAY_MSEC}\n`,Q.textContent+=`LUCKY_MODE: ${Z.LUCKY_MODE}\n`,Q.textContent+=`LUCKY_WEIGHT: ${Math.max(...ie.flat())}\n`,Q.textContent+=`HAND_MODE: ${Z.HAND_MODE}\n`,Q.scroll(0,Q.scrollHeight),await p()}function d(e=de,t=!0){const n=q[e].cloneNode(!0),r=n.getAttribute("class");for(let e=1;e<=Z.BOARD_HEIGHT;e++)for(let o=1;o<=Z.BOARD_WIDTH;o++){const c=Te[e][o];if(t){if(!H(o,e))continue;c.setAttribute("class",r),c.dataset.color=n.dataset.color,c.innerHTML=n.innerHTML}else{const t=x[ae[e][o]].cloneNode(!0),n=c.getAttribute("class"),a=t.getAttribute("class");if(n!==r)continue;c.setAttribute("class",a),c.dataset.color=t.dataset.color,c.innerHTML=t.innerHTML}const a=c.querySelector("text");a.textContent=String(se[e][o]),Ee&&a.classList.replace("hidden","shown")}return ue=t}function u(e=!0){const t=Y.querySelectorAll("svg > text");return t.forEach(t=>{e?t.classList.replace("hidden","shown"):t.classList.replace("shown","hidden")}),Ee=e}function E(e,t,n=Z.BOARD_WIDTH){const r=n+2,o=t*r+e;return o}async function A(e,t){if(!(He||Oe||Se)){if(Ae||(Ae=!0,await T()),P.emptyChild(),!H(e,t,de,!0))return P.appendChild(document.createTextNode("Cannot put ")),P.appendChild(G[de].cloneNode(!0)),void P.appendChild(document.createTextNode(" here."));await h(),await p()}}function H(e,t,n=de,r=!1,o=!0){const c=Te[t][e];let a=0;if(!O(e,t))return 0;const s=o?ae[t][e]:le[t][e];if(s>te.NONE)return 0;if(Z.HAND_MODE){if(O(e,t,he)){if(r)if(o){f(),I(e,t,n);const r=`${g.intToAlp(e-1).toUpperCase()}${t}`;Q.textContent+=`turn: ${ee[n]}, x: ${e}, y: ${t}, xy: ${r}\n`,Q.scroll(0,Q.scrollHeight),fe+=r,L(e,t,n,!0),c.querySelector("rect.highlight-stone").classList.add("highlight-put")}else le[t][e]=n;return 1}return 0}let l=!0;for(let s=-1;s<=1;s++)for(let i=-1;i<=1;i++){if(0===i&&0===s)continue;let T=e+i,d=t+s,u=0,E=o?ae[d][T]:le[d][T];for(;E!==n&&E!==te.NONE;)T+=i,d+=s,u++,E=o?ae[d][T]:le[d][T];if(0!==u&&E!==te.NONE&&(a+=u,r)){if(l)if(o){l=!1,f(),I(e,t,n);const r=`${g.intToAlp(e-1).toUpperCase()}${t}`;Q.textContent+=`turn: ${ee[n]}, x: ${e}, y: ${t}, xy: ${r}\n`,Q.scroll(0,Q.scrollHeight),fe+=r,L(e,t,n,!0),c.querySelector("rect.highlight-stone").classList.add("highlight-put")}else le[t][e]=n;for(T=e+i,d=t+s;u>0;)o?(I(T,d,n),L(T,d,n,!0)):le[d][T]=n,T+=i,d+=s,u--}}return a}function S(e=de){for(let t=1;t<=Z.BOARD_HEIGHT;t++)for(let n=1;n<=Z.BOARD_WIDTH;n++)if(H(n,t,e))return!0;return!1}function O(e,t,n={}){const{WEST:r=1,EAST:o=Z.BOARD_WIDTH,NORTH:c=1,SOUTH:a=Z.BOARD_HEIGHT}=n,s=r<=e&&e<=o,l=c<=t&&t<=a;return s&&l}function L(e,t,n=de,r=!0){if(!O(e,t))return;const o=Te[t][e],c=x[ae[t][e]].cloneNode(!0),a=v[n].cloneNode(!0),s=c.getAttribute("class"),l=a.getAttribute("class");return r?(o.setAttribute("class",l),o.dataset.color=a.dataset.color,o.innerHTML=a.innerHTML):(o.setAttribute("class",s),o.dataset.color=c.dataset.color,o.innerHTML=c.innerHTML),o.querySelector("text").textContent=String(se[t][e]),ie[t][e]>1&&o.classList.add("lucky"),Z.HAND_MODE&&!O(e,t,he)&&o.classList.add("not-init_area"),r}function f(){for(let e=1;e<=Z.BOARD_HEIGHT;e++)for(let t=1;t<=Z.BOARD_WIDTH;t++)L(t,e,de,!1)}function I(e,t,n=de){if(!O(e,t))return;ae[t][e]=n;const r=Te[t][e],o=x[n].cloneNode(!0);r.dataset.color=o.dataset.color,r.innerHTML=o.innerHTML,r.querySelector("text").textContent=String(se[t][e]),ie[t][e]>1&&o.classList.add("lucky"),Z.HAND_MODE&&!O(e,t,he)&&o.classList.add("not-init_area")}async function h(){let e=D(de);if(e&&Se||ce++,Z.HAND_MODE){const e=2,t=ce<Z.COLOR_NUM*e;if(!t)for(let e=1;e<=Z.BOARD_HEIGHT;e++)for(let t=1;t<=Z.BOARD_WIDTH;t++){const n=Te[e][t];O(t,e,he)||n.classList.remove("not-init_area")}Z.HAND_MODE=t}if(He=N(),He)return;ue&&d(de,!1),Ee&&u(!1),de=R(de);const t=z.querySelector("span.color-text"),n=G[de].cloneNode(!0);t.replaceWith(n),e=D(de),Se=!!e||!S(de),Se&&(e||(P.emptyChild(),P.appendChild(document.createTextNode("Cannot put ")),P.appendChild(G[de].cloneNode(!0)),P.appendChild(document.createTextNode(" any position. ")),P.appendChild(G[de].cloneNode(!0)),P.appendChild(document.createTextNode(" is passed.")),Q.textContent+=`turn: ${ee[de]}, pass\n`,Q.scroll(0,Q.scrollHeight),K.disabled=!0,V.disabled=!0,await C(Z.DELAY_MSEC),K.disabled=!1,V.disabled=!1),await h(),await p())}function D(e=de){return Le&&!Z.AI_LIST.includes(e)}function R(e=de,t=ne){return(e+t)%t+1}function _(e=de){let t=0;for(let n=1;n<=Z.BOARD_HEIGHT;n++)for(let r=1;r<=Z.BOARD_WIDTH;r++)ae[n][r]===e&&(t+=ie[n][r]);return t}function N(){for(let e=te.BLACK;e<=Z.COLOR_NUM;e++)if(S(e))return!1;const e=new Array(Z.COLOR_NUM+1).fill(0);for(let t=te.BLACK;t<=Z.COLOR_NUM;t++)e[t]=_(t);let t="";J.emptyChild();let n=!0,r=0,o=te.NONE;for(let c=te.BLACK;c<=Z.COLOR_NUM;c++)t+=`${ee[c]}=${e[c]}, `,J.appendChild(G[c].cloneNode(!0)),J.appendChild(document.createTextNode(`=${e[c]}, `)),e[c]!==e[Z.COLOR_NUM]&&(n=!1),r<e[c]&&(r=e[c],o=c);return n?(t+="draw.",J.appendChild(document.createTextNode("draw."))):(t+=`${ee[o]} won.`,J.appendChild(G[o].cloneNode(!0)),J.appendChild(document.createTextNode(" won."))),P.textContent="This game was over.",z.classList.replace("shown","hidden"),P.classList.replace("hidden","shown"),J.classList.replace("hidden","shown"),f(),d(de,!1),u(!1),K.disabled=!0,V.disabled=!0,Q.textContent+=`result: ${t}\n`,Q.textContent+=`record: ${fe}\n`,Q.textContent+="This game was over.\n",Q.scroll(0,Q.scrollHeight),!0}function C(e){if(e<=0)return new Promise(e=>{e()});if(!Oe){const t=2;e*=t}const t=F.querySelector("progress#progress"),n=F.querySelector('label[for="progress"]'),r=F.querySelector('output[for="progress"]');let o=0;n.textContent=Oe&&!Se?"AI thinking ...":"Please wait ...",t.value=`${o}`,t.textContent=`${o}%`,r.textContent=`${o}%`,F.classList.replace("hidden","shown");let c=Math.max(e/Number(t.max),4),a=Math.trunc(Number(t.max)/(e/c));return new Promise(e=>{Ie=window.setInterval(()=>{o+=a,t.value=`${o}`,t.textContent=`${o}%`,r.textContent=`${o}%`,o>=Number(t.max)&&(F.classList.replace("shown","hidden"),window.clearInterval(Ie),e())},c)})}async function p(){for(const e of Z.AI_LIST)await m()}async function m(){if(!Z.AI_LIST.includes(de))return;if(He)return;Oe=!0,K.disabled=!0,V.disabled=!0,await C(Z.DELAY_MSEC);const[e,t]=W(Z.AI_LEVEL);H(e,t,de,!0),P.emptyChild(),Oe=!1,K.disabled=!1,V.disabled=!1,await h()}function W(e){switch(e){case 0:return B();case 1:return U();case 2:return M();case 3:return b();case 4:return y();case 5:return w();default:exit()}}function B(){for(let e=1;e<=Z.BOARD_HEIGHT;e++)for(let t=1;t<=Z.BOARD_WIDTH;t++)if(H(t,e))return[t,e]}function U(){let e=[];for(let t=1;t<=Z.BOARD_HEIGHT;t++)for(let n=1;n<=Z.BOARD_WIDTH;n++)H(n,t)&&e.push([n,t]);return e[g.randomInt(e.length)]}function M(){let e=1,t=[];for(let n=1;n<=Z.BOARD_HEIGHT;n++)for(let r=1;r<=Z.BOARD_WIDTH;r++){let o=H(r,n);e<=o&&(e<o&&(t=[]),e=o,t.push([r,n]))}return t[g.randomInt(t.length)]}function b(){let e=se[0][0]-1,t=[];for(let n=1;n<=Z.BOARD_HEIGHT;n++)for(let r=1;r<=Z.BOARD_WIDTH;r++)H(r,n)&&e<=se[n][r]&&(e<se[n][r]&&(t=[]),e=se[n][r],t.push([r,n]));return t[g.randomInt(t.length)]}function y(){let e=se[1][1]+1,t=[];for(let n=1;n<=Z.BOARD_HEIGHT;n++)for(let r=1;r<=Z.BOARD_WIDTH;r++){if(le=window.structuredClone(ae),!H(r,n,de,!0,!1))continue;let o=se[0][0]-1;for(let e=1;e<=Z.BOARD_HEIGHT;e++)for(let t=1;t<=Z.BOARD_WIDTH;t++)H(t,e,R(de),!1,!1)&&(o=Math.max(o,se[e][t]));e>=o&&(e>o&&(t=[]),e=o,t.push([r,n]))}let n=se[0][0],r=[];for(const[e,o]of t)n<=se[o][e]&&(n<se[o][e]&&(r=[]),n=se[o][e],r.push([e,o]));return r[g.randomInt(r.length)]}function w(){const e=4;return ce<Math.trunc(oe/e)?b():ce<Math.trunc(2*oe/e)?b():ce<Math.trunc(3*oe/e)?y():M()}const g=await import("../lib/lib.min.js"),x=document.querySelectorAll("div#template-area > svg.cell"),v=document.querySelectorAll("div#template-area > svg.highlight"),q=document.querySelectorAll("div#template-area > svg.assist"),G=document.querySelectorAll("div#template-area > span.color-text"),$=Object.freeze({COLOR_NUM:document.querySelector("select#COLOR_NUM"),BOARD_WIDTH:document.querySelector("input#BOARD_WIDTH"),BOARD_HEIGHT:document.querySelector("input#BOARD_HEIGHT"),AI_LIST:document.querySelectorAll("ul#AI_LIST input"),AI_LEVEL:document.querySelector("select#AI_LEVEL"),DELAY_MSEC:document.querySelector("select#DELAY_MSEC"),LUCKY_MODE:document.querySelector("input#LUCKY_MODE"),HAND_MODE:document.querySelector("input#HAND_MODE")}),k=document.querySelector("button#enter"),Y=document.querySelector("tbody#board"),K=document.querySelector("button#assist"),V=document.querySelector("button#hint"),j=document.querySelector("button#reset"),z=document.querySelector("div#turn"),P=document.querySelector("div#message"),F=document.querySelector("div#wait"),J=document.querySelector("div#result"),Q=document.querySelector("div#log"),X=Object.freeze({COLOR_NUM:2,BOARD_WIDTH:8,BOARD_HEIGHT:8,AI_LIST:[],AI_LEVEL:3,DELAY_MSEC:500,LUCKY_MODE:!1,HAND_MODE:!1});let Z=window.structuredClone(X);const ee=Object.freeze([...G].map(e=>e.textContent.toUpperCase())),te=Object.freeze(g.createEnum(...ee));let ne=0,re=0,oe=0,ce=0,ae=[],se=[],le=[],ie=[],Te=[],de=0,ue=!1,Ee=!1,Ae=!1,He=!1,Se=!1,Oe=!1,Le=!1,fe="",Ie=0,he={};e()});