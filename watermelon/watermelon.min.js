window.addEventListener("DOMContentLoaded",async()=>{"use strict";function t(){e(),o.addEventListener("mousemove",t=>{const e=t.offsetX,i=(t.offsetY,m[v.type].radius);let s=e;s=Math.max(s,a.left+i),s=Math.min(s,a.right-i),v.center.x=s,v.center.y=v.center.y}),o.addEventListener("mouseup",t=>{const e=t.offsetX,i=(t.offsetY,m[x.type].radius);let s=e;v.isActive=!0,p.set(v.id,v),s=Math.max(s,a.left+i),s=Math.min(s,a.right-i),v=new w(new n.Vector2D(s,a.top-i),u,x.type),x=new w(new n.Vector2D((a.right+o.width)/2,a.top+66),u,n.randomIntPdf(m.map(t=>t.odds)))}),i()}function e(){p=new Map,I=0,T=0;const t=n.randomIntPdf(m.map(t=>t.odds)),e=m[t].radius;v=new w(new n.Vector2D(a.left,a.top-e),u,t),x=new w(new n.Vector2D((a.right+o.width)/2,a.top+66),u,n.randomIntPdf(m.map(t=>t.odds)))}function i(){T=window.requestAnimationFrame(i),r.save(),r.clearRect(0,0,o.width,o.height),r.restore(),r.save(),r.beginPath(),r.strokeStyle="black",r.lineWidth=10,r.moveTo(a.left,a.top),r.lineTo(a.left,a.bottom),r.lineTo(a.right,a.bottom),r.lineTo(a.right,a.top),r.stroke(),r.setLineDash([10,10]),r.lineTo(a.left,a.top),r.stroke(),r.closePath(),r.restore(),(()=>{const t=a.left/2,e=a.top,i=30*Math.min(l,c)*h;r.save(),r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.font=`900 ${i}px cursive`,r.fillText("SCORE",t,e),r.font=`900 ${2*i}px cursive`,r.fillText(`${I}`,t,e+66),r.restore()})(),(()=>{x.draw();const t=30*Math.min(l,c)*h;r.save(),r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.font=`900 ${t}px cursive`,r.fillText("NEXT",(a.right+o.width)/2,a.top),r.restore()})(),(()=>{const t=30*Math.min(l,c)*h;r.save(),r.textAlign="left",r.textBaseline="middle",r.fillStyle="black",r.font=`900 ${t}px cursive`;for(const[t,e]of m.entries())r.fillText(`${t+1}: ${e.name}`,(a.right+o.width)/2-88,a.bottom-330+33*t);r.restore()})(),v.draw(),r.save(),r.beginPath(),r.strokeStyle="black",r.lineWidth=5,r.moveTo(v.center.x,v.center.y+v.info.radius),r.lineTo(v.center.x,a.bottom),r.stroke(),r.closePath(),r.restore();for(const t of[...p.values()].toSorted((t,e)=>{const i=new n.Vector2D(t.center.y,t.center.x),s=new n.Vector2D(e.center.y,e.center.x);return i.lt(s)?-1:i.gt(s)?1:0}))t.draw().update().collideWall().collideBall()}function s(){(()=>{const t=90*Math.min(l,c)*h;r.save(),r.font=`900 ${3*t}px cursive`,r.textAlign="center",r.textBaseline="middle",r.fillText("Game Over",o.width/2,o.height/2),r.restore()})(),cancelAnimationFrame(T)}const n=await import("../library/library.min.js"),o=document.querySelector("canvas#canvas"),r=o.getContext("2d");o.width=window.innerWidth,o.height=window.innerHeight;const l=window.innerWidth/1503,c=window.innerHeight/916,h=window.devicePixelRatio/1.5,d=Math.min(l,c)*h,a=(()=>{const t=800*l*h,e=750*c*h;return Object.freeze({left:o.width/2-t/2,right:o.width/2+t/2,top:o.height/2-e/2,bottom:o.height/2+e/2})})(),m=(()=>{class t{constructor(t,e,i,s,n){this.name=t,this.radius=e,this.mass=i,this.point=s,this.odds=n}}return Object.freeze([new t("cherry",59,100,1,20),new t("strawberry",74,96,3,20),new t("grape",113,92,6,20),new t("dekopon",122,88,10,20),new t("persimmon",156,84,15,20),new t("apple",193,80,21,0),new t("pear",230,76,28,0),new t("peach",280,72,36,0),new t("pineapple",316,68,45,0),new t("melon",389,64,55,0),new t("watermelon",460,60,66,0)].map((t,e)=>(t.radius*=.5*d,t.point=1+e*(e+3)/2,t)))})(),f=Object.freeze({GRAVITY:new n.Vector2D(0,10),DELTATIME:.2,ELASTIC:.5,DAMPING:.99,FRICTION:.9});class w{constructor(t,e,i){this.id=y++,this.center=t,this.velocity=e,this.isActive=!1,this.isInit=!0,this.isCollided=!1,this.type=i,this.info=m[i]}draw(){this.id;const t=this.center,e=(this.velocity,this.isActive,this.isInit,this.isCollided,this.type),i=this.info,s=(i.name,i.radius);i.mass,i.point,i.odds;return r.save(),r.beginPath(),r.lineWidth=5,r.strokeStyle="black",r.textAlign="center",r.textBaseline="middle",r.font="900 30px cursive",r.arc(t.x,t.y,s,0,2*Math.PI),r.stroke(),r.fillText(`${e+1}`,t.x,t.y),r.closePath(),r.restore(),this}update(){this.id;const t=this.center,e=this.velocity,i=this.isActive,s=(this.isInit,this.isCollided),o=(this.type,this.info),r=(o.name,o.radius,o.mass,o.point,o.odds,f.GRAVITY),l=f.DELTATIME,c=(f.ELASTIC,f.DAMPING),h=f.FRICTION;if(i)return this.center=t.add(e.mul(l)).add(r.mul(.5*l**2)),this.velocity=e.add(r.mul(l)),this.velocity=this.velocity.mul(c),s&&(this.velocity=this.velocity.mul(h),this.center.distance(t)<n.ZERO.MILI&&(this.center=t,this.velocity=u)),this.isCollided=!1,this}collideWall(){this.id,this.center,this.velocity;const t=this.isActive,e=(this.isInit,this.isCollided,this.type,this.info),i=(e.name,e.radius),o=(e.mass,e.point,e.odds,f.GRAVITY,f.DELTATIME,f.ELASTIC),r=(f.DAMPING,f.FRICTION);if(!t)return;const l={left:a.left+i,right:a.right-i,top:a.top+i,bottom:a.bottom-i};return this.center.x<l.left&&(this.center=new n.Vector2D(l.left,this.center.y),this.velocity=new n.Vector2D(this.velocity.x*-o,this.velocity.y),this.isCollided=!0),this.center.x>l.right&&(this.center=new n.Vector2D(l.right,this.center.y),this.velocity=new n.Vector2D(this.velocity.x*-o,this.velocity.y),this.isCollided=!0),this.center.y<l.top?this.isInit||s():this.isInit=!1,this.center.y>l.bottom&&(this.center=new n.Vector2D(this.center.x,l.bottom),this.velocity=new n.Vector2D(this.velocity.x*r,this.velocity.y*-o),this.isCollided=!0),this}collideBall(){const t=this.id,e=this.center,i=this.velocity,s=this.isActive,o=(this.isInit,this.isCollided,this.type),r=this.info,l=(r.name,r.radius),c=r.mass,h=r.point,d=(r.odds,f.GRAVITY,f.DELTATIME,f.ELASTIC);f.DAMPING,f.FRICTION;if(s){for(const s of[...p.values()].toSorted((t,e)=>{const i=new n.Vector2D(t.center.y,t.center.x),s=new n.Vector2D(e.center.y,e.center.x);return i.lt(s)?-1:i.gt(s)?1:0})){const r=s.id,a=s.center,f=s.velocity,w=s.isActive,y=(s.isInit,s.isCollided,s.type),u=s.info,v=(u.name,u.radius),x=u.mass;u.point,u.odds;if(!w)continue;if(t===r)continue;if(e.distance(a)>=l+v)continue;if(this.isCollided=!0,s.isCollided=!0,o===y){if(this.center=e.add(a).div(2),I+=h,p.delete(r),this.type++,this.type>=m.length){I+=m.slice(-1)[0].point,p.delete(t);continue}this.info=m[this.type]}const T=a.sub(e).normalize(),g=T.rotate(Math.PI/2),A=new n.Vector2D(i.dot(g),i.dot(T)),D=new n.Vector2D(f.dot(g),f.dot(T)),b=c/x,V=x/c,C=new n.Vector2D(A.x,(A.y*(b-d)+D.y*(1+d))/(1+b)),M=new n.Vector2D(D.x,(A.y*(1+d)+D.y*(V-d))/(1+V)),E=e.add(T.mul(l)),P=a.sub(T.mul(v)),k=E.add(P).div(2);this.center=k.sub(T.mul(l)),s.center=k.add(T.mul(v)),this.velocity=g.mul(C.x).add(T.mul(C.y)),s.velocity=g.mul(M.x).add(T.mul(M.y))}return this}}}let y=0;const u=Object.freeze(new n.Vector2D(0,0));let p=new Map,v=new w(u,u,0),x=new w(u,u,0),I=0,T=0;t()});